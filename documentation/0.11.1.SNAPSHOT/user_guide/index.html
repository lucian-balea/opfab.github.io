<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="author" content="David Binder; Boris Dolley; Alexandra Guironnet; Ronan Le Gall">
<title>OperatorFabric User Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>OperatorFabric User Guide</h1>
<div class="details">
<span id="author" class="author">David Binder; Boris Dolley; Alexandra Guironnet; Ronan Le Gall</span><br>
<span id="revnumber">version 0.11.1.SNAPSHOT,</span>
<span id="revdate">October 21, 2019</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">User Guide</div>
<ul class="sectlevel1">
<li><a href="#_deploying_operator_fabric">1. Deploying Operator Fabric</a>
<ul class="sectlevel2">
<li><a href="#_deploy_operator_fabric_with_docker">1.1. Deploy Operator Fabric With Docker</a>
<ul class="sectlevel3">
<li><a href="#_one_container_per_service_deployment">1.1.1. One container per service deployment</a></li>
<li><a href="#_all_in_one_try_me_out_deployment">1.1.2. All-in-one try me out deployment</a></li>
</ul>
</li>
<li><a href="#_run_the_jars">1.2. Run the jars</a></li>
<li><a href="#_kubernetes_deployment">1.3. Kubernetes deployment</a></li>
<li><a href="#_administration">1.4. Administration</a></li>
</ul>
</li>
<li><a href="#_configuration">2. Configuration</a>
<ul class="sectlevel2">
<li><a href="#_global_configuration">2.1. Global configuration</a>
<ul class="sectlevel3">
<li><a href="#_operator_fabric_mongo_configuration">2.1.1. Operator Fabric Mongo configuration</a></li>
<li><a href="#_operator_fabric_specific_configuration">2.1.2. Operator Fabric Specific configuration</a></li>
</ul>
</li>
<li><a href="#_per_service_configuration_guides">2.2. Per service Configuration Guides</a>
<ul class="sectlevel3">
<li><a href="#_cloud_configuration_service">2.2.1. Cloud Configuration service</a></li>
<li><a href="#_cloud_registry_service">2.2.2. Cloud Registry service</a></li>
<li><a href="#_cloud_gateway_service">2.2.3. Cloud Gateway service</a></li>
<li><a href="#_cards_publication_business_service">2.2.4. Cards-Publication Business service</a></li>
<li><a href="#_cards_consultation_business_service">2.2.5. Cards-Consultation Business service</a></li>
<li><a href="#_thirds_business_service">2.2.6. Thirds Business service</a></li>
<li><a href="#_users_business_service">2.2.7. Users Business service</a></li>
<li><a href="#_time_business_service">2.2.8. Time Business service</a></li>
<li><a href="#_web_ui">2.2.9. Web UI</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_reference_guide_per_business_service">3. Reference Guide Per Business Service</a>
<ul class="sectlevel2">
<li><a href="#_card_consultation_service_reference_documentation">3.1. Card Consultation Service Reference Documentation</a>
<ul class="sectlevel3">
<li><a href="#_third_party_endpoint_specification">3.1.1. Third Party Endpoint Specification</a></li>
</ul>
</li>
<li><a href="#_operatorfabric_card_publication_service">3.2. OperatorFabric Card Publication Service</a>
<ul class="sectlevel3">
<li><a href="#_cards_examples">3.2.1. Cards Examples</a></li>
<li><a href="#_card_anatomy">3.2.2. Card Anatomy</a></li>
<li><a href="#_publication_rest_api_overview">3.2.3. Publication REST API Overview.</a></li>
</ul>
</li>
<li><a href="#_card_consultation_service_reference_documentation_2">3.3. Card Consultation Service Reference Documentation</a>
<ul class="sectlevel3">
<li><a href="#_archived_cards">3.3.1. Archived Cards</a></li>
</ul>
</li>
<li><a href="#_operatorfabric_third_service">3.4. OperatorFabric Third service</a>
<ul class="sectlevel3">
<li><a href="#_declaring_a_third_party_service">3.4.1. Declaring a Third Party Service</a></li>
<li><a href="#_technical_overview">3.4.2. Technical overview</a></li>
<li><a href="#TroubleShooting">3.4.3. Troubleshooting</a></li>
</ul>
</li>
<li><a href="#_operatorfabric_user_service">3.5. OperatorFabric User Service</a>
<ul class="sectlevel3">
<li><a href="#_cookbook">3.5.1. Cookbook</a></li>
<li><a href="#_users_and_groups">3.5.2. Users and Groups</a></li>
</ul>
</li>
<li><a href="#_time_service_reference_documentation">3.6. Time Service Reference Documentation</a>
<ul class="sectlevel3">
<li><a href="#_introduction">3.6.1. Introduction</a></li>
<li><a href="#_concepts">3.6.2. Concepts</a></li>
<li><a href="#_api_endpoints">3.6.3. API Endpoints</a></li>
<li><a href="#_demonstration">3.6.4. Demonstration</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_deploying_operator_fabric">1. Deploying Operator Fabric</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For now Operator Fabric consist of Docker images available either by compiling
the project or by using images releases from Dockerhub.</p>
</div>
<div class="sect2">
<h3 id="_deploy_operator_fabric_with_docker">1.1. Deploy Operator Fabric With Docker</h3>
<div class="paragraph">
<p>All our services are build as images. They are deployed on the public
<a href="https://hub.docker.com/">docker hub</a>
Service images are all based on
<a href="https://hub.docker.com/_/openjdk">openjdk:8-jdk-alpine</a></p>
</div>
<div class="sect3">
<h4 id="_one_container_per_service_deployment">1.1.1. One container per service deployment</h4>
<div class="paragraph">
<p>For simple one instance per service deployment, you can find a sample
deployment as a docker-compose file
<a href="https://github.com/opfab/operatorfabric-core/tree/master/src/main/docker/deploy">here</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_all_in_one_try_me_out_deployment">1.1.2. All-in-one try me out deployment</h4>
<div class="paragraph">
<p>In Progress</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_run_the_jars">1.2. Run the jars</h3>
<div class="paragraph">
<p>In Progress</p>
</div>
</div>
<div class="sect2">
<h3 id="_kubernetes_deployment">1.3. Kubernetes deployment</h3>
<div class="paragraph">
<p>In Progress</p>
</div>
</div>
<div class="sect2">
<h3 id="_administration">1.4. Administration</h3>
<div class="paragraph">
<p>Some operations are restricted to users with the <strong>ADMIN</strong> role, either because they are administration
operations with the potential to impact the OperatorFabric instance as a whole, or because they
give access to information that should be private to a user.</p>
</div>
<div class="paragraph">
<p>Below is a quick recap of these restricted operations.</p>
</div>
<div class="paragraph">
<div class="title">Users Service</div>
<p>Any action (read, create/update or delete) regarding a single user&#8217;s data (their personal info such as their first and
last name, as well as their settings) can be performed either by the user in question or by a user with the ADMIN role.</p>
</div>
<div class="paragraph">
<p>Any action on a list of users or on the groups (if authorization is managed in OperatorFabric) can only be performed by
a user with the ADMIN role.</p>
</div>
<div class="paragraph">
<div class="title">Thirds Service</div>
<p>Any write (create, update or delete) action on bundles can only be performed by a user with the ADMIN role. As such,
administrators are responsible for the quality and security of the provided bundles.
In particular, as it is possible to use scripts in templates, they should perform a security check to make sure that
there is no XSS risk.</p>
</div>
<div class="paragraph">
<div class="title">Time Service (for demonstration purposes only)</div>
<p>Any user can get the current state of simulated time but acting on it (changing the speed of time flow, setting
the reference for simulated time or resetting it entirely) requires the ADMIN role.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The ADMIN role doesn&#8217;t grant any special privileges when it comes to card consultation (be they current or
archived), so an user with the ADMIN role will only see cards that have been addressed to them or to one of their
groups), just like any other user.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration">2. Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As a micro service architectured solution, Operator Fabric has multiple services
to configure. These configuration are gathered by a Configuration Service that
can be redunded for safety.</p>
</div>
<div class="paragraph">
<p>See <a href="https://opfab.github.io/documentation/0.11.1.SNAPSHOT/architecture/">Operator Fabric Architecture</a> for more information
on the different services.</p>
</div>
<div class="paragraph">
<p>All services are springboot application and share some common configuration and
uses jetty as an embedded servlet container. The following documentation
references describes Springboot configuration.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/">Springboot documentation</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#boot-features-external-config">Springboot external configuration</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#common-application-properties">Common application properties from Springboot documentation</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_global_configuration">2.1. Global configuration</h3>
<div class="paragraph">
<p>Aside from the configuration service, all configurations are gathered in the
configuration service environment backend (see <a href="#_cloud_configuration_service">Cloud Configuration service</a>).</p>
</div>
<div class="paragraph">
<p>Note that a few things cannot be set in the global configuration backend and
must be set in each services bootstrap configuration file. In this regard,
<a href="#_cloud_configuration_service">Cloud Configuration service</a>[Configuration] and <a href="#_cloud_registry_service">Cloud Registry service</a>[Registry]
services have specific configuration but for other services, they all require
the same minimal information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>mandatory</strong> service name(spring.application.name)</p>
</li>
<li>
<p><strong>mandatory</strong> configuration name (spring.cloud.config.name)</p>
</li>
<li>
<p><strong>mandatory</strong> configuration fetch from registry enabled (spring.cloud.config.discovery.enabled: true)</p>
</li>
<li>
<p><strong>mandatory</strong> configuration service name in registry (spring.cloud.config.discovery.service-id)</p>
</li>
<li>
<p><strong>mandatory</strong> eureka registration (eureka.client.register-with-eureka: true and
eureka.client.fetch-registry: true)</p>
</li>
<li>
<p><strong>mandatory</strong> eureka registry urls (eureka.client.service-url.defaultZone)</p>
</li>
<li>
<p>configuration fail fast (spring.cloud.config.fail-fast)</p>
</li>
<li>
<p>configuration fetch maximum retry (spring.cloud.config.retry.max-attempts)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In most situation, you do not need to change the default bootstrap
configuration for those services. Make a copy of the default bootstrap (inside
the jar or from the sources) and set eureka up (see above).</p>
</div>
<div class="paragraph">
<p>The different services also share common configuration you can setup in the
config service backend. those common configuration may be set up in the backend <code><code>application.yml</code></code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  rabbitmq:
    host: rabbitmq
    port: 5672
    username: guest
    password: guest
  data:
    mongodb:
      uris:
        - mongodb://root:password@mongodb:27017/operator-fabric?authSource=admin&amp;authMode=scram-sha1
  security:
    oauth2:
      resourceserver:
        jwt:
          jwk-set-uri: http://authserver/auth/realms/dev/protocol/openid-connect/certs
eureka:
  client:
    service-url:
      defaultZone: http://registry:8080/eureka
    region: default
  registryFetchIntervalSeconds: 5

operatorfabric:
  security:
    oauth2:
      client-id: opfab-client
      client-secret: opfab-oauth-secret
    jwt:
      login-claim: preferred_username
      expire-claim: exp</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example you can see that we need to configure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RabbitMQ (See <a href="https://docs.spring.io/spring-amqp/docs/2.1.3.RELEASE/reference/htmlsingle//reference/htmlsingle/">spring-amqp doc</a>)</p>
</li>
<li>
<p>MongoDB</p>
</li>
<li>
<p>Eureka (See <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-netflix/2.1.0.RC3//single/spring-cloud-netflix.html#_service_discovery_eureka_clients">spring eureka</a>)</p>
</li>
<li>
<p>Operator Fabric</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_operator_fabric_mongo_configuration">2.1.1. Operator Fabric Mongo configuration</h4>
<div class="paragraph">
<p>We only use URI configuration for mongo through the usage of the <code><code>spring.data.mongodb.uris</code></code>,
it allows us to share the same configuration behavior for simple or cluster
configuration and with both spring classic and reactive mongo configuration.
See <a href="https://docs.mongodb.com/manual/reference//connection-string/">mongo connection string</a> for the complete URI syntax.</p>
</div>
<div class="sect4">
<h5 id="_define_time_to_live_for_archived_cards">Define time to live for archived cards</h5>
<div class="paragraph">
<p>By default, archived cards will remain stored in the database forever. It is possible to have them automatically
removed after a specified duration by using the <a href="https://docs.mongodb.com/manual/core/index-ttl/">TTL index feature of mongoDB</a> on their publishDate field.</p>
</div>
<div class="paragraph">
<p>For example, to have cards expire after 10 days (864000s), enter the following commands in the mongo shell:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">use operator-fabric
db.archivedCards.createIndex( { "publishDate": 1 }, { expireAfterSeconds: 864000 } )</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You cannot use createIndex() to change the value of expireAfterSeconds of an existing index.
Instead use the <a href="https://docs.mongodb.com/manual/reference/command/collMod/#dbcmd.collMod">collMod</a> database command in conjunction with the index collection flag. Otherwise, to
change the value of the option of an existing index, you must drop the index first and recreate.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_operator_fabric_specific_configuration">2.1.2. Operator Fabric Specific configuration</h4>
<div class="paragraph">
<p>Below are description of Operator Fabric specific configuration properties.</p>
</div>
<div class="paragraph">
<p>Note that other components may have specific configuration, see the relevant
sub-sections.</p>
</div>
<div class="sect4">
<h5 id="_security">Security</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">mandatory?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.oauth2.client-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Oauth2 client id used by operator fabric may be specific for each service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.oauth2.client-secret</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Oauth2 client secret used by operator fabric may be specific for each service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.login-claim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sub</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jwt claim to use as user login or id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.expire-claim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jwt claim to use as token expiration timestamp</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_per_service_configuration_guides">2.2. Per service Configuration Guides</h3>
<div class="sect3">
<h4 id="_cloud_configuration_service">2.2.1. Cloud Configuration service</h4>
<div class="paragraph">
<p>Operator Fabric Configuration service is a Spring Cloud Config application
bootstrapped using SpringBoot.</p>
</div>
<div class="paragraph">
<p>In our spring micro service architecture Configuration instances are the first
services to bootstrap, thus they are configured in a specific way contrary to
other services.</p>
</div>
<div class="sect4">
<h5 id="_mandatory_configuration_profiles_and_default_properties">Mandatory configuration, Profiles and default properties</h5>
<div class="paragraph">
<p>To get a working configuration service, there a few mandatory configuration
properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>in a bootstrap file:</p>
<div class="ulist">
<ul>
<li>
<p>The application must have a set name (spring.application.name)</p>
</li>
</ul>
</div>
</li>
<li>
<p>in an application property file</p>
<div class="ulist">
<ul>
<li>
<p>The application must have a configured rabbitmq service for configuration
change notification (spring.rabbitmq.*)</p>
</li>
<li>
<p>The application must have a configured eureka server (eureka.client.*)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For other configuration see <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.1.0.RELEASE/single/spring-cloud-config.html">spring cloud config documentation</a>.</p>
</div>
<div class="paragraph">
<p>Note that it is mandatory to define an environment repository for the service.
Dev and Docker profile uses a file system backend which is not suitable for
production and redundancy. You should prefer the usage of Git or Vault for
production.</p>
</div>
<div class="sect5">
<h6 id="_default_properties">default properties</h6>
<div class="paragraph">
<p>It is preferable not to change the following bootstrap.yml file.</p>
</div>
<div class="paragraph">
<p><em>bootstrap.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: config</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>application.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>management:
  endpoints:
    web:
      exposure:
        include: '*'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above embedded configurations are the basic settings of the application:
* it sets its name as a service (config)
* it exposes management endpoints</p>
</div>
</div>
<div class="sect5">
<h6 id="_dev_profile">dev profile</h6>
<div class="paragraph">
<p>dev is the profile we use internally for developpement we make it available for
external developers so that they don&#8217;t need extensive configuration to get a
jar working in the development environment</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>server:
  port: 2000
spring:
#  level.root: debug
  profiles:
    active: [native,dev]
  cloud:
    config:
      server:
        native:
          search-locations:
           - file:./build/dev-data/dev-configurations
  rabbitmq:
    host: localhost
    port: 5672
    username: guest
    password: guest
eureka:
  client:
    region: default
    service-url:
      defaultZone: http://localhost:2001/eureka
    registryFetchIntervalSeconds: 5</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>it exposes the service on port 2000 (defaults to 8080)</p>
</li>
<li>
<p>it activates the dev and native profile (native is mandatory for serving
config from file system)</p>
</li>
<li>
<p>it configures rabbitmq for dispatching config change messages to other services</p>
</li>
<li>
<p>it configures registration in eureka discovery service</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_docker_profile">docker profile</h6>
<div class="paragraph">
<p>docker is the profile we use in our docker images</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  profiles:
    active: [native]
  cloud:
    config:
      server:
        native:
          search-locations:
           - file:/service-config
  rabbitmq:
    host: ${RABBITMQ_HOST}
    port: ${RABBITMQ_PORT}
    username: ${RABBITMQ_USER}
    password: ${RABBITMQ_PASSWORD}
eureka:
  client:
    region: default
    service-url:
      defaultZone: http://${REGISTRY_HOST}:${REGISTRY_PORT}/eureka
    registryFetchIntervalSeconds: 5</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>it activates the native profile (native is mandatory for serving
config from file system)</p>
</li>
<li>
<p>it configures rabbitmq for dispatching config change messages to other services</p>
</li>
<li>
<p>it configures registration in eureka discovery service</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_external_configuration_properties_when_lauching_a_jar_file">Specifying external configuration properties when lauching a jar file</h5>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#boot-features-external-config-application-property-files">Application Property Files</a>
on how to setup an external spring properties or yml file.</p>
</div>
<div class="paragraph">
<p>Seehttps://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#howto-set-active-spring-profiles[Set the Active Spring Profiles] for specifying alternate profile.</p>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_lauching_a_docker_image">Specifying configuration properties when lauching a docker image</h5>
<div class="paragraph">
<p>Our docker image expects optional property file to be stored in the container
/service-config folder. You can bind so docker volume to this path to make
properties or yml available.</p>
</div>
<div class="paragraph">
<p>At time of writting, you cannot specify an alternate profile at runtime.
The default profiles activated are docker and native.</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_for_docker_image">Available environment variables for docker image</h6>
<div class="ulist">
<ul>
<li>
<p>RABBITMQ_HOST: Rabbitmq host name</p>
</li>
<li>
<p>RABBITMQ_PORT: Rabbitmq host port</p>
</li>
<li>
<p>RABBITMQ_USER: Rabbitmq user name used for authentication service</p>
</li>
<li>
<p>RABBITMQ_PASSWORD: Rabbitmq user password used for authentication service</p>
</li>
<li>
<p>REGISTRY_HOST: Registry (eureka) host name</p>
</li>
<li>
<p>REGISTRY_PORT: Registry (eureka) host port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_lauching_on_kubernetes">Specifying configuration properties when lauching on Kubernetes</h5>
<div class="paragraph">
<p>In progress</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_when_launching_on_kubernetes">Available environment variables when launching on Kubernetes</h6>
<div class="ulist">
<ul>
<li>
<p>RABBITMQ_HOST: Rabbitmq host name</p>
</li>
<li>
<p>RABBITMQ_PORT: Rabbitmq host port</p>
</li>
<li>
<p>RABBITMQ_USER: Rabbitmq user name used for authentication service</p>
</li>
<li>
<p>RABBITMQ_PASSWORD: Rabbitmq user password used for authentication service</p>
</li>
<li>
<p>REGISTRY_HOST: Registry (eureka) host name</p>
</li>
<li>
<p>REGISTRY_PORT: Registry (eureka) host port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cloud_registry_service">2.2.2. Cloud Registry service</h4>
<div class="paragraph">
<p>Operator Fabric Registry service is a Spring Eureka application
bootstrapped using SpringBoot.</p>
</div>
<div class="paragraph">
<p>In our spring micro service architecture Eureka Registry instances are the second
services to bootstrap, its configuration relies on the <a href="#_cloud_configuration_service">Cloud Configuration service</a>.</p>
</div>
<div class="sect4">
<h5 id="_mandatory_configuration_profiles_and_default_properties_2">Mandatory configuration, Profiles and default properties</h5>
<div class="paragraph">
<p>To get a working registry service, there a few mandatory configuration
properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In a bootstrap file</p>
<div class="ulist">
<ul>
<li>
<p>The application must have a set name (spring.application.name)</p>
</li>
<li>
<p>The application must have a set configuration name (spring.cloud.config.name)</p>
</li>
<li>
<p>The application must have a set configuration server (spring.cloud.config.uri)</p>
</li>
<li>
<p>The application may have a retry/failfast configuration for config access
(spring.cloud.config.failfast, spring.cloud.config.retry)</p>
</li>
</ul>
</div>
</li>
<li>
<p>In a configuration service registry.yml file</p>
<div class="ulist">
<ul>
<li>
<p>The application may deactivate eureka registration to avoid self registration
(deactivated by default in internal application.yml file)</p>
</li>
<li>
<p>The application must set the Eureka instance hostname (eureka.instance.hostname)</p>
</li>
<li>
<p>The application must set the Eureka default zone (eureka.lient.serviceUrl.defaultZone)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For other configuration see <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-netflix/2.1.0.RC3/single/spring-cloud-netflix.html">spring cloud netflix documentation</a>.</p>
</div>
<div class="sect5">
<h6 id="_default_properties_2">default properties</h6>
<div class="paragraph">
<p>It is preferable not to change the following bootstrap.yml file.</p>
</div>
<div class="paragraph">
<p><em>bootstrap.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: registry
  cloud.config:
    name: registry
    fail-fast: true</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-docker.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: registry
  cloud.config:
    name: registry
    uri: http://${CONFIG_HOST}:${CONFIG_PORT}
    failFast: true
    retry:
      maxAttempts: 50</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-dev.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: registry
  cloud.config:
    name: registry
    uri: http://localhost:2000</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>application.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>eureka:
  client:
    register-with-eureka: false
    fetch-registry: false</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bootstrap-docker.yml file is a replacement bootstrap file we use for our
docker images configuration.</p>
</div>
<div class="paragraph">
<p>The bootstrap-dev.yml file is a replacement bootstrap file we use for our
developpement environment</p>
</div>
<div class="paragraph">
<p>The above embedded configurations are the basic settings of the application:
* it sets its name as a service (config)
* it sets the configuration name to use (which configuration file to retrieve)
* it must set the configuration service (example in bootstrap-docker.yml)</p>
</div>
</div>
<div class="sect5">
<h6 id="_dev_profile_2">dev profile</h6>
<div class="paragraph">
<p>dev is the profile we use internally for developpement we make it available for
external developers so that they don&#8217;t need extensive configuration to get a
jar working in the development environment</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>server:
  port: 2001
eureka:
  instance.hostname: localhost
  client.serviceUrl.defaultZone: http://localhost:2001/eureka/</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_sample_developpement_configuration">Sample developpement configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>server:
  port: 2001
eureka:
  instance.hostname: localhost
  client.serviceUrl.defaultZone: http://localhost:2001/eureka/</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_sample_docker_image_configuration">Sample docker image configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>eureka:
  instance.hostname: registry
  client:
    serviceUrl.defaultZone: http://registry:8080/eureka/
    registerWithEureka: false
    fetchRegistry: false
    server:
      waitTimeInMsWhenSyncEmpty: 0</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_external_configuration_properties_when_lauching_a_jar_file_2">Specifying external configuration properties when lauching a jar file</h5>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#boot-features-external-config-application-property-files">Application Property Files</a>
on how to setup an external spring properties or yml file.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#howto-set-active-spring-profiles">Set the Active Spring Profiles</a> for specifying alternate profile.</p>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_lauching_a_docker_image_2">Specifying configuration properties when lauching a docker image</h5>
<div class="paragraph">
<p>Our docker image expects optional property file to be stored in the container
/service-config folder. You can bind so docker volume to this path to make
properties or yml available.</p>
</div>
<div class="paragraph">
<p>At time of writting, you cannot specify an alternate profile at runtime.
The default profiles activated are docker and native.</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_for_docker_image_2">Available environment variables for docker image</h6>
<div class="ulist">
<ul>
<li>
<p>CONFIG_HOST: Configuration service host</p>
</li>
<li>
<p>CONFIG_PORT: Configuration service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_lauching_on_kubernetes_2">Specifying configuration properties when lauching on Kubernetes</h5>
<div class="paragraph">
<p>In progress</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_when_launching_on_kubernetes_2">Available environment variables when launching on Kubernetes</h6>
<div class="ulist">
<ul>
<li>
<p>CONFIG_HOST: Configuration service host</p>
</li>
<li>
<p>CONFIG_PORT: Configuration service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cloud_gateway_service">2.2.3. Cloud Gateway service</h4>
<div class="paragraph">
<p>Operator Fabric Client Gateway service is a Spring Cloud Gateway application
bootstrapped using SpringBoot.</p>
</div>
<div class="paragraph">
<p>In our spring micro service architecture the gateway service depends on Eureka
Registry.</p>
</div>
<div class="sect4">
<h5 id="_mandatory_configuration_profiles_and_default_properties_3">Mandatory configuration, Profiles and default properties</h5>
<div class="paragraph">
<p>To get a working gateway service, there a few mandatory configuration
properties:</p>
</div>
<div class="paragraph">
<p>In a configuration service client-gateway.yml file</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The application must set up a route to the oauth server</p>
<div class="ulist">
<ul>
<li>
<p>/auth/token(?&lt;path&gt;.*) must match the oauth2 token entry point</p>
</li>
<li>
<p>/auth/code/(?&lt;params&gt;.*) must match the auth entry point with specific query
parameters : response_type=code&amp;client_id=[client id]&amp;${params}</p>
</li>
<li>
<p>/auth/check_token must match token introspection entry point</p>
</li>
</ul>
</div>
</li>
<li>
<p>The application may set up CORS rules if api are to be accessed outside of
the deployment domain</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For other configuration see <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.1.0.RELEASE/single/spring-cloud-gateway.html">spring cloud gateway documentation</a>.</p>
</div>
<div class="sect5">
<h6 id="_service_specific_properties">Service specific properties</h6>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">mandatory?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.gateway.configs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">an array of string for each allowed config entries</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_default_properties_3">default properties</h6>
<div class="paragraph">
<p>Note that you must provide a bootstrap file with a convenient registry configuration</p>
</div>
<div class="paragraph">
<p><em>bootstrap.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: client-gateway
  cloud:
    config:
      name: client-gateway
      fail-fast: true
      retry:
        max-attempts: 20
      discovery:
        service-id: config
        enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-docker.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: client-gateway
  cloud:
    config:
      name: client-gateway
      failFast: true
      retry:
        maxAttempts: 20
      discovery:
        service-id: config
        enabled: true
eureka:
  client:
    registerWithEureka: true
    fetchRegistry: true
    registryFetchIntervalSeconds: 5
    service-url:
      defaultZone: 'http://${REGISTRY_HOST}:${REGISTRY_PORT}/eureka/'</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-dev.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: client-gateway
  cloud:
    config:
      name: client-gateway
      failFast: true
      retry:
        max-attempts: 20
      discovery:
        service-id: config
        enabled: true
eureka:
  client:
    register-with-eureka: true
    fetch-registry: true
    service-url:
      defaultZone: 'http://localhost:2001/eureka/'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bootstrap-docker.yml file is a replacement bootstrap file we use for our
docker images configuration.</p>
</div>
<div class="paragraph">
<p>The bootstrap-dev.yml file is a replacement bootstrap file we use for our
development environment</p>
</div>
<div class="paragraph">
<p>The above embedded configurations are the basic settings of the application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it sets its service name</p>
</li>
<li>
<p>it sets the configuration name to use (which configuration file to retrieve)</p>
</li>
<li>
<p>it must set the registry service (example in bootstrap-docker.yml)</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_sample_developpement_configuration_2">Sample developpement configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>server:
  port: 2002
spring:
  cloud:
    gateway:
      routes:
      - id: auth
        uri: http://localhost:89
        predicates:
        - Path=/auth/**
        filters:
        - RewritePath=/auth/token(?&lt;path&gt;.*), /auth/realms/dev/protocol/openid-connect/token$\{path}
        - RewritePath=/auth/code/(?&lt;params&gt;.*), /auth/realms/dev/protocol/openid-connect/auth?response_type=code&amp;client_id=opfab-client&amp;$\{params}
        - RewritePath=/auth/check_token, /auth/realms/dev/protocol/openid-connect/token/introspect
        - AddRequestHeader=Authorization, Basic b3BmYWItY2xpZW50Om9wZmFiLWtleWNsb2FrLXNlY3JldA==
      globalcors:
        corsConfigurations:
          '[/**]':
            allowedOrigins: "*"
            allowedMethods: "*"
            allowedHeaders: "Authorization, Content-Type"
operatorfabric.gateway.configs:
  - web-ui.json
#logging.level.root: debug</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_sample_docker_image_configuration_2">Sample docker image configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  cloud:
    gateway:
      routes:
      - id: auth
        uri: http://keycloak:8080
        predicates:
        - Path=/auth/**
        filters:
        - RewritePath=/auth/token(?&lt;path&gt;.*), /auth/realms/dev/protocol/openid-connect/token$\{path}
        - RewritePath=/auth/code/(?&lt;params&gt;.*), /auth/realms/dev/protocol/openid-connect/auth?response_type=code&amp;client_id=opfab-client&amp;$\{params}
        - RewritePath=/auth/check_token, /auth/realms/dev/protocol/openid-connect/token/introspect
        - AddRequestHeader=Authorization, Basic b3BmYWItY2xpZW50Om9wZmFiLWtleWNsb2FrLXNlY3JldA==
      globalcors:
        corsConfigurations:
          '[/**]':
            allowedOrigins: "*"
            allowedMethods: "*"
            allowedHeaders: "Authorization, Content-Type"
operatorfabric.gateway.configs:
  - web-ui.json</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_external_configuration_properties_when_lauching_a_jar_file_3">Specifying external configuration properties when lauching a jar file</h5>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#boot-features-external-config-application-property-files">Application Property Files</a>
on how to setup an external spring properties or yml file.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#howto-set-active-spring-profiles">Set the Active Spring Profiles</a> for specifying alternate profile.</p>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_lauching_a_docker_image_3">Specifying configuration properties when lauching a docker image</h5>
<div class="paragraph">
<p>Our docker image expects optional property file to be stored in the container
/service-config folder. You can bind so docker volume to this path to make
properties or yml available.</p>
</div>
<div class="paragraph">
<p>At time of writting, you cannot specify an alternate profile at runtime.
The default profiles activated are docker and native.</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_for_docker_image_3">Available environment variables for docker image</h6>
<div class="ulist">
<ul>
<li>
<p>REGISTRY_HOST: Registry service host</p>
</li>
<li>
<p>REGISTRY_PORT: Registry service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_lauching_on_kubernetes_3">Specifying configuration properties when lauching on Kubernetes</h5>
<div class="paragraph">
<p>In progress</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_when_launching_on_kubernetes_3">Available environment variables when launching on Kubernetes</h6>
<div class="ulist">
<ul>
<li>
<p>REGISTRY_HOST: Registry service host</p>
</li>
<li>
<p>REGISTRY_PORT: Registry service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cards_publication_business_service">2.2.4. Cards-Publication Business service</h4>
<div class="paragraph">
<p>Operator Fabric Cards-Publication Business service is a Spring Webflux application
bootstrapped using SpringBoot.</p>
</div>
<div class="paragraph">
<p>In our spring micro service architecture this service depends on Eureka
Registry.</p>
</div>
<div class="sect4">
<h5 id="_mandatory_configuration_profiles_and_default_properties_4">Mandatory configuration, Profiles and default properties</h5>
<div class="paragraph">
<p>The service has no mandatory configuration beside global configuration and
usual bootstrap configuration.</p>
</div>
<div class="paragraph">
<p>For other configuration see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/">Spring Boot documentation</a>.</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.1.4.RELEASE/spring-framework-reference/web-reactive.html#webflux">Spring MVC documentation</a>.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_service_specific_properties_2">Service specific properties</h6>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">mandatory?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.card-write.window.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">card input window size to fill before flush</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.card-write.window.timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">card input window millis wait time before flush</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.card-notification.window.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">card notification window size to fill before flush</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.card-notification.window.timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">card notification window millis wait time before flush</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_default_properties_4">default properties</h6>
<div class="paragraph">
<p>Note that you must provide a bootstrap file with a convenient registry configuration</p>
</div>
<div class="paragraph">
<p><em>bootstrap.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: cards-publication
  cloud:
    config:
      name: cards-publication
      fail-fast: true
      retry:
        max-attempts: 20
      discovery:
        service-id: config
        enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-docker.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: cards-publication
  cloud:
    config:
      name: cards-publication
      failFast: true
      retry:
        maxAttempts: 20
      discovery:
        service-id: config
        enabled: true
#  level.root: debug
eureka:
  client:
    registerWithEureka: true
    fetchRegistry: true
    registryFetchIntervalSeconds: 5
    service-url:
      defaultZone: 'http://${REGISTRY_HOST}:${REGISTRY_PORT}/eureka/'</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-dev.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: cards-publication
  cloud:
    config:
      name: cards-publication
      fail-fast: true
      retry:
        max-attempts: 20
      discovery:
        service-id: config
        enabled: true
eureka:
  client:
    service-url:
      defaultZone: 'http://localhost:2001/eureka'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bootstrap-docker.yml file is a replacement bootstrap file we use for our
docker images configuration.</p>
</div>
<div class="paragraph">
<p>The bootstrap-dev.yml file is a replacement bootstrap file we use for our
development environment</p>
</div>
<div class="paragraph">
<p>The above embedded configurations are the basic settings of the application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it sets its service name</p>
</li>
<li>
<p>it sets the configuration name to use (which configuration file to retrieve)</p>
</li>
<li>
<p>it must set the registry service (example in bootstrap-docker.yml)</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_sample_developpement_configuration_3">Sample developpement configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Unresolved directive in ../../../../services/core/cards-publication/src/docs/asciidoc/configuration.adoc - include::../../../../../infra/config/src/main/docker/volume/dev-configurations/cards-Publication.yml[]</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_sample_docker_image_configuration_3">Sample docker image configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Unresolved directive in ../../../../services/core/cards-publication/src/docs/asciidoc/configuration.adoc - include::../../../../../infra/config/src/main/docker/volume/docker-configurations/cards-Publication.yml[]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_external_configuration_properties_when_lauching_a_jar_file_4">Specifying external configuration properties when lauching a jar file</h5>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#boot-features-external-config-application-property-files">Application Property Files</a>
on how to setup an external spring properties or yml file.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#howto-set-active-spring-profiles">Set the Active Spring Profiles</a> for specifying alternate profile.</p>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_lauching_a_docker_image_4">Specifying configuration properties when lauching a docker image</h5>
<div class="paragraph">
<p>Our docker image expects optional property file to be stored in the container
/service-config folder. You can bind so docker volume to this path to make
properties or yml available.</p>
</div>
<div class="paragraph">
<p>At time of writing, you cannot specify an alternate profile at runCards-Publication.
The default profiles activated are docker and native.</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_for_docker_image_4">Available environment variables for docker image</h6>
<div class="ulist">
<ul>
<li>
<p>REGISTRY_HOST: Registry service host</p>
</li>
<li>
<p>REGISTRY_PORT: Registry service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_lauching_on_kubernetes_4">Specifying configuration properties when lauching on Kubernetes</h5>
<div class="paragraph">
<p>In progress</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_when_launching_on_kubernetes_4">Available environment variables when launching on Kubernetes</h6>
<div class="ulist">
<ul>
<li>
<p>REGISTRY_HOST: Registry service host</p>
</li>
<li>
<p>REGISTRY_PORT: Registry service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cards_consultation_business_service">2.2.5. Cards-Consultation Business service</h4>
<div class="paragraph">
<p>Operator Fabric Cards-Consultation Business service is a Spring Webflux application
bootstrapped using SpringBoot.</p>
</div>
<div class="paragraph">
<p>In our spring micro service architecture this service depends on Eureka
Registry.</p>
</div>
<div class="sect4">
<h5 id="_mandatory_configuration_profiles_and_default_properties_5">Mandatory configuration, Profiles and default properties</h5>
<div class="paragraph">
<p>The service has no mandatory configuration beside global configuration and
usual bootstrap configuration.</p>
</div>
<div class="paragraph">
<p>For other configuration see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/">Spring Boot documentation</a>.</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.1.4.RELEASE/spring-framework-reference/web-reactive.html#webflux">Spring MVC documentation</a>.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_service_specific_properties_3">Service specific properties</h6>

</div>
<div class="sect5">
<h6 id="_default_properties_5">default properties</h6>
<div class="paragraph">
<p>Note that you must provide a bootstrap file with a convenient registry configuration</p>
</div>
<div class="paragraph">
<p><em>bootstrap.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: cards-consultation
  cloud:
    config:
      name: cards-consultation
      fail-fast: true
      retry:
        max-attempts: 20
      discovery:
        service-id: config
        enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-docker.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: cards-consultation
  cloud:
    config:
      name: cards-consultation
      failFast: true
      retry:
        maxAttempts: 20
      discovery:
        service-id: config
        enabled: true
#  level.root: debug
eureka:
  client:
    registerWithEureka: true
    fetchRegistry: true
    registryFetchIntervalSeconds: 5
    service-url:
      defaultZone: 'http://${REGISTRY_HOST}:${REGISTRY_PORT}/eureka/'</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-dev.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: cards-consultation
  cloud:
    config:
      name: cards-consultation
      fail-fast: true
      retry:
        max-attempts: 20
      discovery:
        service-id: config
        enabled: true
#  level.root: debug
eureka:
  client:
    service-url:
      defaultZone: 'http://localhost:2001/eureka'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bootstrap-docker.yml file is a replacement bootstrap file we use for our
docker images configuration.</p>
</div>
<div class="paragraph">
<p>The bootstrap-dev.yml file is a replacement bootstrap file we use for our
development environment</p>
</div>
<div class="paragraph">
<p>The above embedded configurations are the basic settings of the application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it sets its service name</p>
</li>
<li>
<p>it sets the configuration name to use (which configuration file to retrieve)</p>
</li>
<li>
<p>it must set the registry service (example in bootstrap-docker.yml)</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_sample_developpement_configuration_4">Sample developpement configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Unresolved directive in ../../../../services/core/cards-consultation/src/docs/asciidoc/configuration.adoc - include::../../../../../infra/config/src/main/docker/volume/dev-configurations/cards-Consultation.yml[]</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_sample_docker_image_configuration_4">Sample docker image configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Unresolved directive in ../../../../services/core/cards-consultation/src/docs/asciidoc/configuration.adoc - include::../../../../../infra/config/src/main/docker/volume/docker-configurations/cards-Consultation.yml[]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_external_configuration_properties_when_lauching_a_jar_file_5">Specifying external configuration properties when lauching a jar file</h5>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#boot-features-external-config-application-property-files">Application Property Files</a>
on how to setup an external spring properties or yml file.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#howto-set-active-spring-profiles">Set the Active Spring Profiles</a> for specifying alternate profile.</p>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_lauching_a_docker_image_5">Specifying configuration properties when lauching a docker image</h5>
<div class="paragraph">
<p>Our docker image expects optional property file to be stored in the container
/service-config folder. You can bind so docker volume to this path to make
properties or yml available.</p>
</div>
<div class="paragraph">
<p>At time of writing, you cannot specify an alternate profile at runCards-Consultation.
The default profiles activated are docker and native.</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_for_docker_image_5">Available environment variables for docker image</h6>
<div class="ulist">
<ul>
<li>
<p>REGISTRY_HOST: Registry service host</p>
</li>
<li>
<p>REGISTRY_PORT: Registry service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_lauching_on_kubernetes_5">Specifying configuration properties when lauching on Kubernetes</h5>
<div class="paragraph">
<p>In progress</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_when_launching_on_kubernetes_5">Available environment variables when launching on Kubernetes</h6>
<div class="ulist">
<ul>
<li>
<p>REGISTRY_HOST: Registry service host</p>
</li>
<li>
<p>REGISTRY_PORT: Registry service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_thirds_business_service">2.2.6. Thirds Business service</h4>
<div class="paragraph">
<p>Operator Fabric Thirds Business service is a Spring MVC application
bootstrapped using SpringBoot.</p>
</div>
<div class="paragraph">
<p>In our spring micro service architecture this service depends on Eureka
Registry.</p>
</div>
<div class="sect4">
<h5 id="_mandatory_configuration_profiles_and_default_properties_6">Mandatory configuration, Profiles and default properties</h5>
<div class="paragraph">
<p>The service has no mandatory configuration beside global configuration and
usual bootstrap configuration.</p>
</div>
<div class="paragraph">
<p>For other configuration see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/">Spring Boot documentation</a>.</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.1.4.RELEASE/spring-framework-reference/web.html#mvc">Spring MVC documentation</a>.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_service_specific_properties_4">Service specific properties</h6>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">mandatory?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.thirds.storage.path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File path to data storage folder</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_default_properties_6">default properties</h6>
<div class="paragraph">
<p>Note that you must provide a bootstrap file with a convenient registry configuration</p>
</div>
<div class="paragraph">
<p><em>bootstrap.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: thirds
  cloud:
    config:
      name: thirds
      fail-fast: true
      retry:
        max-attempts: 20
      discovery:
        service-id: config
        enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-docker.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: thirds
  cloud:
    config:
      name: thirds
      failFast: true
      retry:
        maxAttempts: 20
      discovery:
        service-id: config
        enabled: true
#  level.root: debug
eureka:
  client:
    registerWithEureka: true
    fetchRegistry: true
    registryFetchIntervalSeconds: 5
    service-url:
      defaultZone: 'http://${REGISTRY_HOST}:${REGISTRY_PORT}/eureka/'</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-dev.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: thirds
  cloud:
    config:
      name: thirds
      fail-fast: true
      retry:
        max-attempts: 20
      discovery:
        service-id: config
        enabled: true
eureka:
  client:
    service-url:
      defaultZone: 'http://localhost:2001/eureka'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bootstrap-docker.yml file is a replacement bootstrap file we use for our
docker images configuration.</p>
</div>
<div class="paragraph">
<p>The bootstrap-dev.yml file is a replacement bootstrap file we use for our
development environment</p>
</div>
<div class="paragraph">
<p>The above embedded configurations are the basic settings of the application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it sets its service name</p>
</li>
<li>
<p>it sets the configuration name to use (which configuration file to retrieve)</p>
</li>
<li>
<p>it must set the registry service (example in bootstrap-docker.yml)</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_sample_developpement_configuration_5">Sample developpement configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>server:
  port: 2100
operatorfabric.thirds:
  storage:
    path: "./services/core/thirds/build/docker-volume/thirds-storage"</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_sample_docker_image_configuration_5">Sample docker image configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>operatorfabric.thirds:
  storage:
    path: "/thirds-storage"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_external_configuration_properties_when_lauching_a_jar_file_6">Specifying external configuration properties when lauching a jar file</h5>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#boot-features-external-config-application-property-files">Application Property Files</a>
on how to setup an external spring properties or yml file.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#howto-set-active-spring-profiles">Set the Active Spring Profiles</a> for specifying alternate profile.</p>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_lauching_a_docker_image_6">Specifying configuration properties when lauching a docker image</h5>
<div class="paragraph">
<p>Our docker image expects optional property file to be stored in the container
/service-config folder. You can bind so docker volume to this path to make
properties or yml available.</p>
</div>
<div class="paragraph">
<p>At time of writing, you cannot specify an alternate profile at runThirds.
The default profiles activated are docker and native.</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_for_docker_image_6">Available environment variables for docker image</h6>
<div class="ulist">
<ul>
<li>
<p>REGISTRY_HOST: Registry service host</p>
</li>
<li>
<p>REGISTRY_PORT: Registry service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_lauching_on_kubernetes_6">Specifying configuration properties when lauching on Kubernetes</h5>
<div class="paragraph">
<p>In progress</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_when_launching_on_kubernetes_6">Available environment variables when launching on Kubernetes</h6>
<div class="ulist">
<ul>
<li>
<p>REGISTRY_HOST: Registry service host</p>
</li>
<li>
<p>REGISTRY_PORT: Registry service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_users_business_service">2.2.7. Users Business service</h4>
<div class="paragraph">
<p>Operator Fabric Users Business service is a Spring MVC application
bootstrapped using SpringBoot.</p>
</div>
<div class="paragraph">
<p>In our spring micro service architecture this service depends on Eureka
Registry.</p>
</div>
<div class="sect4">
<h5 id="_mandatory_configuration_profiles_and_default_properties_7">Mandatory configuration, Profiles and default properties</h5>
<div class="paragraph">
<p>The service has no mandatory configuration beside global configuration and
usual bootstrap configuration.</p>
</div>
<div class="paragraph">
<p>For other configuration see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/">Spring Boot documentation</a>.</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.1.4.RELEASE/spring-framework-reference/web.html#mvc">Spring MVC documentation</a>.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_service_specific_properties_5">Service specific properties</h6>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">mandatory?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.users.default.users</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array of user objects to create upon startup if they don&#8217;t exist</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.users.default.user-settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array of user settings objects to create upon startup if they don&#8217;t exist</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.users.default.groups</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array of group objects to create upon startup if they don&#8217;t exist</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_default_properties_7">default properties</h6>
<div class="paragraph">
<p>Note that you must provide a bootstrap file with a convenient registry configuration</p>
</div>
<div class="paragraph">
<p><em>bootstrap.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: users
  cloud:
    config:
      name: users
      fail-fast: true
      retry:
        max-attempts: 20
      discovery:
        service-id: config
        enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-docker.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: users
  cloud:
    config:
      name: users
      failFast: true
      retry:
        maxAttempts: 20
      discovery:
        service-id: config
        enabled: true
#  level.root: debug
eureka:
  client:
    registerWithEureka: true
    fetchRegistry: true
    registryFetchIntervalSeconds: 5
    service-url:
      defaultZone: 'http://${REGISTRY_HOST}:${REGISTRY_PORT}/eureka/'</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-dev.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: users
  cloud:
    config:
      name: users
      fail-fast: true
      retry:
        max-attempts: 20
      discovery:
        service-id: config
        enabled: true
eureka:
  client:
    service-url:
      defaultZone: 'http://localhost:2001/eureka'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bootstrap-docker.yml file is a replacement bootstrap file we use for our
docker images configuration.</p>
</div>
<div class="paragraph">
<p>The bootstrap-dev.yml file is a replacement bootstrap file we use for our
development environment</p>
</div>
<div class="paragraph">
<p>The above embedded configurations are the basic settings of the application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it sets its service name</p>
</li>
<li>
<p>it sets the configuration name to use (which configuration file to retrieve)</p>
</li>
<li>
<p>it must set the registry service (example in bootstrap-docker.yml)</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_sample_developpement_configuration_6">Sample developpement configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>server:
  port: 2103
operatorfabric.users.default:
  users:
    - login: admin
      groups: ["ADMIN"]
    - login: rte-operator
      groups: ["RTE","ADMIN","TRANS"]
    - login: tso1-operator
      groups: ["TSO1","TRANS"]
    - login: tso2-operator
      groups: ["TSO2", "TRANS"]
  groups:
    - name: ADMIN
      description: The admin group
    - name: RTE
      description: RTE TSO Group
    - name: TSO1
      description: TSO 1 Group
    - name: TSO2
      description: TSO 2 Group
    - name: TRANS
      description: Transnationnal Group
  user-settings:
    - login: rte-operator
      description: Da Operator Rulez
operatorfabric:
  security:
    jwt:
      groups:
        mode: OPERATOR_FABRIC # value possible JWT | OPERATOR_FABRIC
#logging.level.root: DEBUG</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_sample_docker_image_configuration_6">Sample docker image configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>operatorfabric.users.default:
  users:
  - login: admin
    groups: ["ADMIN"]
  - login: rte-operator
    groups: ["RTE","ADMIN","TRANS"]
  - login: tso1-operator
    groups: ["TSO1","TRANS"]
  - login: tso2-operator
    groups: ["TSO2", "TRANS"]
  groups:
  - name: ADMIN
    description: The admin group
  - name: RTE
    description: RTE TSO Group
  - name: TSO1
    description: TSO 1 Group
  - name: TSO2
    description: TSO 2 Group
  - name: TRANS
    description: Transnationnal Group
operatorfabric:
  security:
    jwt:
      groups:
        mode: OPERATOR_FABRIC</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_external_configuration_properties_when_lauching_a_jar_file_7">Specifying external configuration properties when lauching a jar file</h5>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#boot-features-external-config-application-property-files">Application Property Files</a>
on how to setup an external spring properties or yml file.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#howto-set-active-spring-profiles">Set the Active Spring Profiles</a> for specifying alternate profile.</p>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_lauching_a_docker_image_7">Specifying configuration properties when lauching a docker image</h5>
<div class="paragraph">
<p>Our docker image expects optional property file to be stored in the container
/service-config folder. You can bind so docker volume to this path to make
properties or yml available.</p>
</div>
<div class="paragraph">
<p>At time of writing, you cannot specify an alternate profile at runUsers.
The default profiles activated are docker and native.</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_for_docker_image_7">Available environment variables for docker image</h6>
<div class="ulist">
<ul>
<li>
<p>REGISTRY_HOST: Registry service host</p>
</li>
<li>
<p>REGISTRY_PORT: Registry service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_lauching_on_kubernetes_7">Specifying configuration properties when lauching on Kubernetes</h5>
<div class="paragraph">
<p>In progress</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_when_launching_on_kubernetes_7">Available environment variables when launching on Kubernetes</h6>
<div class="ulist">
<ul>
<li>
<p>REGISTRY_HOST: Registry service host</p>
</li>
<li>
<p>REGISTRY_PORT: Registry service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_time_business_service">2.2.8. Time Business service</h4>
<div class="paragraph">
<p>Operator Fabric Time Business service is a Spring MVC application
bootstrapped using SpringBoot.</p>
</div>
<div class="paragraph">
<p>In our spring micro service architecture this service depends on Eureka
Registry.</p>
</div>
<div class="sect4">
<h5 id="_mandatory_configuration_profiles_and_default_properties_8">Mandatory configuration, Profiles and default properties</h5>
<div class="paragraph">
<p>The service has no mandatory configuration beside global configuration and
usual bootstrap configuration.</p>
</div>
<div class="paragraph">
<p>For other configuration see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/">Spring Boot documentation</a>.</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.1.4.RELEASE/spring-framework-reference/web.html#mvc">Spring MVC documentation</a>.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_service_specific_properties_6">Service specific properties</h6>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">mandatory?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.time.default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forced time at startup in millis from epoch</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_default_properties_8">default properties</h6>
<div class="paragraph">
<p>Note that you must provide a bootstrap file with a convenient registry configuration</p>
</div>
<div class="paragraph">
<p><em>bootstrap.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: time
  cloud:
    config:
      name: time
      fail-fast: true
      retry:
        max-attempts: 20
      discovery:
        service-id: config
        enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-docker.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: time
  cloud:
    config:
      name: time
      failFast: true
      retry:
        maxAttempts: 20
      discovery:
        service-id: config
        enabled: true
#  level.root: debug
eureka:
  client:
    registerWithEureka: true
    fetchRegistry: true
    registryFetchIntervalSeconds: 5
    service-url:
      defaultZone: 'http://${REGISTRY_HOST}:${REGISTRY_PORT}/eureka/'</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-dev.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: time
  cloud:
    config:
      name: time
      fail-fast: true
      retry:
        max-attempts: 20
      discovery:
        service-id: config
        enabled: true
eureka:
  client:
    service-url:
      defaultZone: 'http://localhost:2001/eureka/'
#  instance:
#    ip-address: localhost
#    non-secure-port: 2101</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bootstrap-docker.yml file is a replacement bootstrap file we use for our
docker images configuration.</p>
</div>
<div class="paragraph">
<p>The bootstrap-dev.yml file is a replacement bootstrap file we use for our
development environment</p>
</div>
<div class="paragraph">
<p>The above embedded configurations are the basic settings of the application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it sets its service name</p>
</li>
<li>
<p>it sets the configuration name to use (which configuration file to retrieve)</p>
</li>
<li>
<p>it must set the registry service (example in bootstrap-docker.yml)</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_sample_developpement_configuration_7">Sample developpement configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>server:
  port: 2101
operatorfabric.time.default: 1497484800000</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_sample_docker_image_configuration_7">Sample docker image configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>operatorfabric.time.default: 1497484800000</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_external_configuration_properties_when_lauching_a_jar_file_8">Specifying external configuration properties when lauching a jar file</h5>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#boot-features-external-config-application-property-files">Application Property Files</a>
on how to setup an external spring properties or yml file.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#howto-set-active-spring-profiles">Set the Active Spring Profiles</a> for specifying alternate profile.</p>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_lauching_a_docker_image_8">Specifying configuration properties when lauching a docker image</h5>
<div class="paragraph">
<p>Our docker image expects optional property file to be stored in the container
/service-config folder. You can bind so docker volume to this path to make
properties or yml available.</p>
</div>
<div class="paragraph">
<p>At time of writting, you cannot specify an alternate profile at runtime.
The default profiles activated are docker and native.</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_for_docker_image_8">Available environment variables for docker image</h6>
<div class="ulist">
<ul>
<li>
<p>REGISTRY_HOST: Registry service host</p>
</li>
<li>
<p>REGISTRY_PORT: Registry service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_lauching_on_kubernetes_8">Specifying configuration properties when lauching on Kubernetes</h5>
<div class="paragraph">
<p>In progress</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_when_launching_on_kubernetes_8">Available environment variables when launching on Kubernetes</h6>
<div class="ulist">
<ul>
<li>
<p>REGISTRY_HOST: Registry service host</p>
</li>
<li>
<p>REGISTRY_PORT: Registry service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_web_ui">2.2.9. Web UI</h4>
<div class="paragraph">
<p>Operator Fabric Web UI service is a Spring MVC application bootstrapped using
SpringBoot. Its sole purpose is to serve the Angular SPA to browsers.</p>
</div>
<div class="paragraph">
<p>In our spring micro service architecture this service depends on Eureka
Registry.</p>
</div>
<div class="sect4">
<h5 id="_mandatory_configuration_profiles_and_default_properties_9">Mandatory configuration, Profiles and default properties</h5>
<div class="paragraph">
<p>The service has no mandatory configuration beside global configuration and
usual bootstrap configuration.</p>
</div>
<div class="paragraph">
<p>For other configuration see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/">Spring Boot documentation</a>.</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.1.4.RELEASE/spring-framework-reference/web-reactive.html#webflux">Spring MVC documentation</a>.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_service_specific_properties_7">Service specific properties</h6>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">mandatory?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.oauth2.flow.mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PASSWORD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication mode (CODE: Authorization Code Flow, PASSWORD: Direct Password Flow)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.oauth2.flow.provider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">provider name to display on log in button</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.oauth2.flow.delegate-url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Url to redirect the browser to for authentication, mandatory with CODE flow</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.feed.subscription.timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Milliseconds between card subscription renewal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.feed.card.time.display</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BUSINESS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>card time display mode in the feed. Values :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>BUSINESS: displays card with entire business period;</p>
</li>
<li>
<p>BUSINESS_START: displays card with business start date;</p>
</li>
<li>
<p>PUBLICATION: displays card with publication date;</p>
</li>
<li>
<p>LTTD: displays card with lttd date;</p>
</li>
<li>
<p>NONE: nothing displayed.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.feed.timeline.hide</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, the time line is not loaded in the feed screen</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.feed.timeFilter.followClockTick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, the time filter on the feed will shift
to reflect elapsed time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.i18n.supported.locales</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of supported locales (Only fr and en so far)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.i10n.supported.time-zones</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of supported time zones, for instance 'Europe/Paris'.
Values should be taken from the <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">TZ database</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeZone</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default user time zone for users (use browser time zone if not set)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default user time format (moment)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.dateFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default user date format (moment)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.dateTimeFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LL LT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default user date format (moment)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.locale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">en</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default user locale (use en if not set)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.default-tags</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default user list of filtered in tags</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.time.pulse</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duration between two ticks of the internal state of the User Interface</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.archive.filters.page.size</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The page size of archive filters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.archive.filters.page.first</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The first page start of archiving module</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.archive.filters.process.list</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of processes to choose from in the corresponding filter in archives</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.archive.filters.tags.list</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of tags to choose from in the corresponding filter in archives</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.logo.base64</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The encoding result of converting the svg logo to Base64, use this <a href="https://base64.guru/converter/encode/image/svg">online tool</a> to encode your svg</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.tags.hide</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control if you want to show or hide the tags filter in settings and feed page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.infos.disable</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control if we want to disable/enable editing user email, description in the settings page</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>User Settings default values</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mandatory?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeZone</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default user time zone for users (use browser time zone if not set)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default user time format (moment)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.dateFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default user date format (moment)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.dateTimeFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LL LT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default user date format (moment)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.locale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default user locale (use browser if not set)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.default-tags</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default user list of filtered in tags</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.dateInsideTooltipsWeek</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.dateInsideTooltipsWeek</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ddd DD MMM HH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format use on date inside tooltips for time&#8217;s unit lower than hour</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.dateInsideTooltipsMonth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ddd DD MMM YYYY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format use on date inside tooltips for other case</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.dateOnDay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ddd DD MMM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format use for display a day and month informations with day name, number, and month</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.dateOnWeek</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DD/MM/YY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format use for display a week information with day number, month number and two last year&#8217;s number</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.dateOnMonth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MMM YY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format use for display a month information with month name and two last year&#8217;s number</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.dateOnYear</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">YYYY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format use for display a year information</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.titleDateInsideTooltips</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DD/MM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format use on first part of title inside tooltips showing day number and month number of its date</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.titleHourInsideTooltips</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HH:mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format use on second part of title inside tooltips showing hours and minutes of its date</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.dateOnDayNewYear</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DD MMM YY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format use for display first year&#8217;s day on a day configuration display day number, month name and two last year&#8217;s number</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.realTimeBarFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DD/MM/YY HH:mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format use on real time bar date, show minutes, hours, day number, month number and two last year&#8217;s number</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.dateSimplifliedOnDayNewYear</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D MMM YY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format use on date configuration for first year&#8217;s day, show simplified day number, month name and last two year&#8217;s number</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.dateSimplifliedOnDay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D MMM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format use on date configuration, show simplified day number and month name</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.hoursOnly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format for show only hours</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.minutesOnly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format for show only minutes</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.secondedsOnly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ss</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format for show only seconds</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.weekNumberOnly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ww</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format for show only week number</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_default_properties_9">default properties</h6>
<div class="paragraph">
<p>Note that you must provide a bootstrap file with a convenient registry configuration</p>
</div>
<div class="paragraph">
<p><em>bootstrap.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: web-ui
  cloud:
    config:
      name: web-ui
      fail-fast: true
      retry:
        max-attempts: 20
      discovery:
        service-id: config
        enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-docker.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: web-ui
  cloud:
    config:
      name: web-ui
      failFast: true
      retry:
        maxAttempts: 20
      discovery:
        service-id: config
        enabled: true
#  level.root: debug
eureka:
  client:
    registerWithEureka: true
    fetchRegistry: true
    registryFetchIntervalSeconds: 5
    service-url:
      defaultZone: 'http://${REGISTRY_HOST}:${REGISTRY_PORT}/eureka/'</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-dev.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: web-ui
  cloud:
    config:
      name: web-ui
      fail-fast: true
      retry:
        max-attempts: 20
      discovery:
        service-id: config
        enabled: true
eureka:
  client:
    service-url:
      defaultZone: 'http://localhost:2001/eureka'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bootstrap-docker.yml file is a replacement bootstrap file we use for our
docker images configuration.</p>
</div>
<div class="paragraph">
<p>The bootstrap-dev.yml file is a replacement bootstrap file we use for our
development environment</p>
</div>
<div class="paragraph">
<p>The above embedded configurations are the basic settings of the application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it sets its service name</p>
</li>
<li>
<p>it sets the configuration name to use (which configuration file to retrieve)</p>
</li>
<li>
<p>it must set the registry service (example in bootstrap-docker.yml)</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_sample_development_configuration">Sample development configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>server:
  port: 2200
operatorfabric:
  security:
    oauth2:
      flow:
        mode: CODE
        provider: Opfab Keycloak
        delagate-url: http://localhost:89/auth/realms/dev/protocol/openid-connect/auth?response_type=code&amp;client_id=opfab-client
  feed:
    subscription:
      timeout: 600000
    card:
      time:
        display: BUSINESS
  archive:
    filters:
      page.size:
        - "10"
      page.first:
        - "0"
      publisher.list:
        - value: "TEST"
          label: "Test Publisher"
        - value: "TEST2"
          label: "Test Publisher 2"
      process.list:
            - process
            - someOtherProcess
      tags.list:
        - value: "tag1"
          label: "Label for tag 1"
        - value: "tag2"
          label: "Label for tag 2"
  i10n.supported.time-zones:
    - value: "Europe/Paris"
      label: "Headquarters timezone"
    - value: "Australia/Melbourne"
      label: "Down Under"
    - Europe/London
    - Europe/Dublin
    - Europe/Brussel
    - Europe/Berlin
    - Europe/Rome
    - Europe/Madrid
    - Europe/Lisbon
    - Europe/Amsterdam
    - Europe/Athens
    - Pacific/Samoa
  i18n.supported.locales:
    - fr
    - en
  settings:
    locale: en
  time:
    pulse: 5000</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_sample_docker_image_configuration_8">Sample docker image configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>operatorfabric:
  security:
    oauth2:
      flow:
        mode: CODE
        provider: Opfab Keycloak
        delagate-url: http://localhost:89/auth/realms/dev/protocol/openid-connect/auth?response_type=code&amp;client_id=opfab-client
  feed:
    subscription:
      timeout: 600000
    card:
      time:
        display: BUSINESS
  archive:
    filters:
      publisher.list:
        - value: "TEST"
          label: "Test Publisher"
        - value: "TEST2"
          label: "Test Publisher 2"
      process.list:
        - process
        - someOtherProcess
      tags.list:
        - value: "tag1"
          label: "Label for tag 1"
        - value: "tag2"
          label: "Label for tag 2"
  i10n.supported.time-zones:
    - value: "Europe/Paris"
      label: "Headquarters timezone"
    - value: "Australia/Melbourne"
      label: "Down Under"
    - Europe/London
    - Europe/Dublin
    - Europe/Brussel
    - Europe/Berlin
    - Europe/Rome
    - Europe/Madrid
    - Europe/Lisbon
    - Europe/Amsterdam
    - Europe/Athens
    - Pacific/Samoa
  i18n.supported.locales:
  - fr
  - en
  settings:
    locale: en</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_external_configuration_properties_when_lauching_a_jar_file_9">Specifying external configuration properties when lauching a jar file</h5>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#boot-features-external-config-application-property-files">Application Property Files</a>
on how to setup an external spring properties or yml file.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#howto-set-active-spring-profiles">Set the Active Spring Profiles</a> for specifying alternate profile.</p>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_lauching_a_docker_image_9">Specifying configuration properties when lauching a docker image</h5>
<div class="paragraph">
<p>Our docker image expects optional property file to be stored in the container
/service-config folder. You can bind so docker volume to this path to make
properties or yml available.</p>
</div>
<div class="paragraph">
<p>At time of writing, you cannot specify an alternate profile at runCards-Publication.
The default profiles activated are docker and native.</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_for_docker_image_9">Available environment variables for docker image</h6>
<div class="ulist">
<ul>
<li>
<p>REGISTRY_HOST: Registry service host</p>
</li>
<li>
<p>REGISTRY_PORT: Registry service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_lauching_on_kubernetes_9">Specifying configuration properties when lauching on Kubernetes</h5>
<div class="paragraph">
<p>In progress</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_when_launching_on_kubernetes_9">Available environment variables when launching on Kubernetes</h6>
<div class="ulist">
<ul>
<li>
<p>REGISTRY_HOST: Registry service host</p>
</li>
<li>
<p>REGISTRY_PORT: Registry service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reference_guide_per_business_service">3. Reference Guide Per Business Service</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_card_consultation_service_reference_documentation">3.1. Card Consultation Service Reference Documentation</h3>
<div class="sect3">
<h4 id="_third_party_endpoint_specification">3.1.1. Third Party Endpoint Specification</h4>
<div class="paragraph">
<p>URL Action may specify any url as action to trigger but those resourse must
comply to certain constraints</p>
</div>
<div class="sect4">
<h5 id="_get">GET</h5>
<div class="paragraph">
<p>An access to the resource using GET method allow to gather information to
update the corresponding action.</p>
</div>
<div class="sect5">
<h6 id="_return_codes">return codes</h6>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">payload</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ok</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">payload is an action status</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no content</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">action is not updated</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not found</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no action associated with URL</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_response_payload">response payload</h6>
<div class="paragraph">
<p>See Actions Service Rest API for complete structure.</p>
</div>
<div class="paragraph">
<p>This reponse gathers information to update the client side behavior of the action.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_post">POST</h5>
<div class="paragraph">
<p>An access to the resource using POST method allow to submit the action
to trigger business behavior.</p>
</div>
<div class="sect5">
<h6 id="_return_codes_2">return codes</h6>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">payload</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ok</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">payload is an action status</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no content</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">action is not updated on submission</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not found</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no action associated with URL</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_submission_payload">submission payload</h6>
<div class="paragraph">
<p>(Not implemented)</p>
</div>
<div class="paragraph">
<p>Submission payload is a json object containing information submitted by
the operator. The structure of the object reflects</p>
</div>
</div>
<div class="sect5">
<h6 id="_response_payload_2">response payload</h6>
<div class="paragraph">
<p>See Actions Service Rest API for complete structure.</p>
</div>
<div class="paragraph">
<p>This reponse gathers information to update the client side behavior of the action.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_operatorfabric_card_publication_service">3.2. OperatorFabric Card Publication Service</h3>
<div class="paragraph">
<p>The Card Publication Service is the entry point in OpeartorFabric to send information to Operators. The cards are the bearer of this information in OperatorFabric system. They are composed of 3 differents parts. The technical one is destined to the internal mecanism of card managing of Operator Fabric, the second one is the data itself destined to the Operator and the third and last one is the formatting information, which indicates OperatorFabric how to display the card data to the operator.</p>
</div>
<div class="paragraph">
<p>To have an overview of the card publication you could go through the 101 document. If it&#8217;s ok for you, let&#8217;s dive more deeply in the cards anatomy and then we will explore the subtilities of the Card publication API.</p>
</div>
<div class="paragraph">
<p>But mainly, before everything else, posting a card in OperatorFabric is done by using a POST request sending the card as Json object in the request body.</p>
</div>
<div id="_publish_card" class="paragraph">
<p>For a card stored in a file named <code>card.json</code>, with an OperatorFabric running on the localhost the <code>cURL</code> command could be:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X POST http://localhost:2102/cards -H "Content-Type:application/type" --data @card.json</pre>
</div>
</div>
<div class="paragraph">
<p>For more details about possibilities about the Card Publication REST API please refere to the <a href="#_publication_rest_api_overview">Publication REST API Overview.</a> chapter or to the <a href="https://opfab.github.io/projects/services/core/cards-publication/0.1.1.RELEASE/api/">swagger documentation</a>.</p>
</div>
<div class="sect3">
<h4 id="_cards_examples">3.2.1. Cards Examples</h4>
<div class="paragraph">
<p>Before detailing the content of cards, let&#8217;s show you what cards look like through few examples of json.</p>
</div>
<div class="sect4">
<h5 id="_minimal_card">Minimal Card</h5>
<div class="paragraph">
<p>The OperatorFabric Card specification defines 7 mandatory attributes, but some optional attributes are needed for cards to be useful in OperatorFabric. Let&#8217;s clarify those point through few examples of minimal cards and what happens when they&#8217;re used as if.</p>
</div>
<div class="sect5">
<h6 id="_send_to_one_user">Send to One User</h6>
<div class="paragraph">
<p>The following card contains only the mandatory attributes.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"TSO1",
	"publisherVersion":"0.1",
	"processId":"process-000",
	"startDate":"1546297200000",
	"severity":"NOTIFICATION",
	"title":{"key":"card.title.key"},
	"summary":{"key":"card.summary.key"},
	"recipient":{
		"type":"USER",
		"identity":"tso1-operator"
	}

}</pre>
</div>
</div>
<div class="paragraph">
<p>This an information about the process <code>process-000</code>, send by the <code>TSO1</code>. The title and the summary refere to <code>i18n</code> keys defined in the associated <code>i18n</code> files of the pulbisher. This card is displayable since the first januray of 2019 and should only be received by the user using the <code>tso1-operator</code> login.</p>
</div>
</div>
<div class="sect5">
<h6 id="_send_to_several_users">Send to several users</h6>
<div class="sect6">
<h7 id="_simple_case">Simple case</h7>
<div class="paragraph">
<p>The following example is nearly the same as the previous one except for the recipient.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"TSO1",
	"publisherVersion":"0.1",
	"processId":"process-000",
	"startDate":"1546297200000",
	"severity":"NOTIFICATION",
	"title":{"key":"card.title.key"},
	"summary":{"key":"card.summary.key"},
	"recipient":{
		"type":"GROUP",
		"identity":"TSO1"
	}

}</pre>
</div>
</div>
<div class="paragraph">
<p>The recipient is here a group, the <code>TSO1</code>. So all users whoa are member of this group will receive the card.</p>
</div>
</div>
<div class="sect6">
<h7 id="_complexe_case">Complexe case</h7>
<div class="paragraph">
<p>If this card need to be view by a user who is not in the <code>TSO1</code> group, it&#8217;s possible to tune more precisely the definition of the recipient. If the <code>tso2-operator</code> needs to see also this card, the recipient definition could be(the following code details only the recipient part):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"recipient":{
	"type":"UNION",
	"recipients":[
		{ "type": "GROUP", "identity":"TSO1"},
		{ "type": "USER", "identity":"tso2-operator"}
		]
	}</pre>
</div>
</div>
<div class="paragraph">
<p>So here, all the users of the <code>TSO1</code> group will received the <code>NOTIFICATION</code> as should the <code>tos2-operator</code> user.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_regular_card">Regular Card</h5>
<div class="paragraph">
<p>The previous cards were nearly empty regarding information carrying. In fact, cards are intented to contains more information than a title and a summary. The optional attribute <code>data</code> is here for that. This attribute is destined to contains any <code>json</code> object. The creator of the card is free to put any information needed as long as it&#8217;s in a <code>json</code> format.</p>
</div>
<div class="sect5">
<h6 id="_full_of_hidden_data">Full of Hidden data</h6>
<div class="paragraph">
<p>For this example we will use our previous example for the <code>TSO1</code> group with a <code>data</code> attribute containing the definition of a <code>json</code> object containing two attributes: <code>stringExample</code> and <code>numberExample</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"TSO1",
	"publisherVersion":"0.1",
	"processId":"process-000",
	"startDate":"1546297200000",
	"severity":"NOTIFICATION",
	"title":{"key":"card.title.key"},
	"summary":{"key":"card.summary.key"},
	"recipient":{
		"type":"USER",
		"identity":"tso1-operator"
	},
	"data":{
		"stringExample":"This is a not so random string of characters.",
		"numberExample":123
		}

}</pre>
</div>
</div>
<div class="paragraph">
<p>This card contains some data but when selected in the feed nothing more than the previous example of card happen because there is no rendering configuration.</p>
</div>
</div>
<div class="sect5">
<h6 id="_fully_useful">Fully useful</h6>
<div class="paragraph">
<p>When a card is selected in the feed (of the GUI), the data is display in the detail panel. The way details are formatted depends on template uploaded by Third parties as <a href="https://opfab.github.io/projects/services/core/thirds/0.1.1.RELEASE/reference/#_bundle">describe here</a>. To have an effective example without to many actions to performed, the following example will use an alerady existing configuration.The one presents in the developpement version of OperatorFabric, for test purpose(<code>TEST</code> bundle).</p>
</div>
<div class="paragraph">
<p>At the card level, the attribtues in the card telling OperatorFabric which template to use is the <code>details</code> attributes.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"TEST",
	"pulisherVersion":"1",
	"processId":"process-000",
	"startDate":"1546297200000",
	"severity":"NOTIFICATION",
	"title":{"key":"process.title"},
	"summary":{"key":"process.summary"},
	"recipient":{
		"type":"USER",
		"identity":"tso1-operator"
	},
	"data":{"rootProp":"Data displayed in the detail panel"},
	"details":[{"title":{"key":"process.detail.tab.first"}, "templateName":"template1"}]

}</pre>
</div>
</div>
<div class="paragraph">
<p>So here a single custome data is defined and it&#8217;s <code>rootProp</code>. This attribute is used by the template called by the <code>details</code> attribute. This attribute contains an array of <code>json</code> object containing an <code>i18n</code> key and a <code>template</code> reference. Each of those object is a tab in the detail panel of the GUI. The template to used are defined and configured in the <code>Third</code> bundle upload into the server by the publisher.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_displaying_rules">Displaying Rules</h5>
<div class="sect5">
<h6 id="_dates">Dates</h6>
<div class="paragraph">
<p>Dates impact both the feed rendering and the timeline rendering.</p>
</div>
<div class="paragraph">
<p>In the feed cards are visible based on a collection of filters among which a
time filter.</p>
</div>
<div class="paragraph">
<p>In the time line cards are visible based on a similar filter plus the time line
renders the "position" in time of said cards. By default it groups cards at
close time in bubbles whom color indicates severity and inner number indicates
number of cards.</p>
</div>
<div class="sect6">
<h7 id="_start_date_startdate">Start Date (<code>startDate</code>)</h7>
<div class="paragraph">
<p>The card is only display after this date is reach by the current time. It&#8217;s a mandatory attributes for OperatorFabric cards.</p>
</div>
<div class="paragraph">
<p>example:</p>
</div>
<div class="paragraph">
<p>The current day is the 29 january of 2019.</p>
</div>
<div class="paragraph">
<p>A card with the following configuration <code>"startDate":"1548758040000"</code>, has a start date equals to the iso date: "2019-01-29T10:34:00Z". So the operator will see it appearing in it&#8217;s feed at 10h34 AM universal time. And if there is no <code>endDate</code> defines for it, it will stay in the feed indefinitely, so this card should be still visible the 30th january of 2019. Before "10h34 AM universal time", this card was not visible in the feed.</p>
</div>
</div>
<div class="sect6">
<h7 id="_end_date_enddate">End Date (<code>endDate</code>)</h7>
<div class="paragraph">
<p>This optional attribute, corresponds to the moment afterwhich the card will be remove from the feed of the GUI.</p>
</div>
<div class="paragraph">
<p>example:</p>
</div>
<div class="paragraph">
<p>Imagine that the current day is still the 29 january of 2019.</p>
</div>
<div class="paragraph">
<p>The card we are looking after, has the same value for the startDate than in the previous example but has the following configuration for the <code>endDate</code>: <code>"endDate":"1548765240000"</code>. It&#8217;s correpsonding to "2019-01-29T12:34:00Z" universal time.</p>
</div>
<div class="paragraph">
<p>So our card is present in the feed between "11h34" and "13h34". Before and after those hours, the card is not available.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_card_recipients">Recipients</h6>
<div class="paragraph">
<p>The attribute <code>recepient</code> of a card tells to whom it&#8217;s sent. It&#8217;s value format is an <a href="../api/#Recipient"><code>object named recipient</code></a> that describe the rule for recipient computation.</p>
</div>
<div class="paragraph">
<p>The available types are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>GROUP</code></p>
</li>
<li>
<p><code>USER</code></p>
</li>
<li>
<p><code>UNION</code></p>
</li>
<li>
<p><code>INTERSECT</code></p>
</li>
<li>
<p><code>RANDOM</code></p>
</li>
<li>
<p><code>WEIGHTED</code></p>
</li>
<li>
<p><code>FAVORITE</code></p>
</li>
<li>
<p><code>BROADCAST</code></p>
</li>
<li>
<p><code>DEADEND</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The simplest way to determine the recipient is to assign the card to a <code>user</code> or a <code>group</code> as seen <a href="#_minimal_card">previously in  "Minimal Card"</a>.</p>
</div>
<div class="paragraph">
<p>But it&#8217;s possible to combine groups and potentially users using <code>UNION</code> and <code>INTERSECT</code> type to have a better control on whom should receive the card.</p>
</div>
<div class="sect6">
<h7 id="_union">UNION</h7>
<div class="paragraph">
<p>For example, if a card is destined to the operators of <code>TSO1</code> and <code>TSO2</code> and need to be alos view by the <code>admin</code> the recipient configuration looks like:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"recipient":{"type":"UNION",
	"recipients":[
		{"type":"GROUP","identity":"TSO1"},
		{"type":"GROUP","identity":"TSO2"},
		{"type":"USER","identity":"admin"}
		]
	}</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_intersect">INTERSECT</h7>
<div class="paragraph">
<p>To target all users member of the <code>admin</code> group in the <code>TSO2</code> group, the recipient rule could be:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"recipient":{"type":"INTERSECT",
	"recipients":[
		{"type":"GROUP","identity":"TSO1"},
		{"type":"GROUP","identity":"ADMIN"}
		]
	}</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_card_anatomy">3.2.2. Card Anatomy</h4>
<div class="paragraph">
<p>Cards are modelized as <code>Json</code> objects. The technical design of card is describe in <a href="../api/#Card">the swagger api description of Card Publication Service</a>. A card correspond to the state of a Processus in OperatorFabric.</p>
</div>
<div class="sect4">
<h5 id="_technical_information_of_the_card">Technical Information of the card</h5>
<div class="paragraph">
<p>Those attributes are used by OperatorFabric to manage how cards are stored, to whom and when they&#8217;re sended.</p>
</div>
<div class="sect5">
<h6 id="_mandotory_information">Mandotory information</h6>
<div class="paragraph">
<p>Below, the <code>json</code> technical key is in the '()' following the title.</p>
</div>
<div class="sect6">
<h7 id="_card_publisher">Publisher (<code>publisher</code>)</h7>
<div class="paragraph">
<p>Quite obviously it&#8217;s the Third party which publish the card. This information is used to look up for Presentation resources of the card.</p>
</div>
</div>
<div class="sect6">
<h7 id="_card_publisher_version">Publisher Version (<code>publisherVersion</code>)</h7>
<div class="paragraph">
<p>Refers the <code>version</code> of <code>publisher third</code> to use to render this card (i18n, title, summary, media and details).
As through time, the presentation of a publisher card data changes, this changes are managed through <code>publisherVersion</code> in OperatorFabric. Each version is keep in the system in order to be able to display correctely old cards.</p>
</div>
</div>
<div class="sect6">
<h7 id="_process_identifier_processid">Process Identifier (<code>processId</code>)</h7>
<div class="paragraph">
<p>It&#8217;s the way to identify the process to which the card is associated. A card represent a state of a process.</p>
</div>
</div>
<div class="sect6">
<h7 id="startDate">Start Date (<code>startDate</code>)</h7>
<div class="paragraph">
<p>This attribute is a part of the card life management system. It&#8217;s indicate OperatorFabric the moment since the card can be diplay to the opertors or main receipients, <a href="#_displaying_rules">see Displaying rules</a>.</p>
</div>
</div>
<div class="sect6">
<h7 id="_severity_severity">Severity (<code>severity</code>)</h7>
<div class="paragraph">
<p>The severity is a core principe of the OperatorFabric Card system. There are 4 serverities available(<a href="../api/#SeverityEnum">Technical definition of OperatorFabric Card Severity</a>). A color is associated in the GUI to each severity. Here the details about severity and their meaning for OperatorFabric:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ALARM: representes a critical state of the associated process, need an action from the operator. In the Gui, the card is red;</p>
</li>
<li>
<p>ACTION: the associated process need an action form operators in order to evolve correctly. In the Gui, an action is orange;</p>
</li>
<li>
<p>QUESTION: an operator need to give specific information to the associated process in order to evolve correctly. In the UI, an action is blue.;</p>
</li>
<li>
<p>NOTIFICATION: give information to the operator. In the GUI, a notification is green.</p>
</li>
</ol>
</div>
</div>
<div class="sect6">
<h7 id="cardTitle">Title (<code>title</code>)</h7>
<div class="paragraph">
<p>This attribute is display as header of a card in the feed of the GUI. It&#8217;s the main User destined Information of a card. The value refer to an <code>i18n</code> value used to localized this information.</p>
</div>
</div>
<div class="sect6">
<h7 id="cardSummary">Summary (<code>summary</code>)</h7>
<div class="paragraph">
<p>This attribute is display as a description of a card in the feed of the GUI, when the card is selected by the operator. It&#8217;s completing the information of the card title. The value refer to an <code>i18n</code> value used to localized this information.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_recipient_recipient">Recipient (<code>recipient</code>)</h6>
<div class="paragraph">
<p>Declares to whom the card is send. For more details about way recipient works <a href="#_displaying_rules">see Displaying rules</a>. Without recipient declaration a card is useless in <code>OperatorFabric</code> system.</p>
</div>
</div>
<div class="sect5">
<h6 id="_store_information">Store information</h6>
<div class="sect6">
<h7 id="_tags_tag">Tags (<code>tag</code>)</h7>
<div class="paragraph">
<p>Tags are intended to enable filter of cards in the feed of the GUI.</p>
</div>
</div>
<div class="sect6">
<h7 id="_uid_uid">uid (<code>uid</code>)</h7>
<div class="paragraph">
<p>Unique identifier of the card in the OperatorFabric system. This attribute can be send with card, but normally it&#8217;s manage by <code>OperatorFabric</code> system.</p>
</div>
</div>
<div class="sect6">
<h7 id="_id_id">id (<code>id</code>)</h7>
<div class="paragraph">
<p>State id of the associated process, determines by <code>OperatorFabric</code> can be set abritrarly by the <code>publisher</code>.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_card_life_management_configuration">Card Life Management Configuration</h6>
<div class="paragraph">
<p>With this attributes OperatorFabric know when to display or hide cards, but also if an action is still available for a given card.</p>
</div>
<div class="sect6">
<h7 id="_start_date_startdate_2">Start Date (<code>startDate</code>)</h7>
<div class="paragraph">
<p><a href="#startDate">see Start Date in Technical Information of the Card</a> and <a href="#_displaying_rules">for more examples</a>.</p>
</div>
</div>
<div class="sect6">
<h7 id="_end_date_enddate_2">End Date (<code>endDate</code>)</h7>
<div class="paragraph">
<p>Fixes the moment until when <code>OperatorFabric</code> displays the card. After the card is remove from the GUI feed, <a href="#_display_rules">see Display Rules for some examples</a>.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_last_time_to_decide_lttd">Last Time to Decide (<code>lttd</code>)</h6>
<div class="paragraph">
<p>Fixes the moment until when a <code>actions</code> associated to the card are available. After then, the associated actions won&#8217;t be displayed or actionnable.</p>
</div>
</div>
<div class="sect5">
<h6 id="_other_technical_attributes">Other technical attributes</h6>

</div>
<div class="sect5">
<h6 id="_publish_date_publishdate">Publish Date (<code>publishDate</code>)</h6>
<div class="paragraph">
<p>Indicates when the card has been registred in <code>OperatorFabric</code> sytsem. This is a technical information exclusively managed by <code>OperatorFabric</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_deletion_date_deletiondate">Deletion Date (`deletionDate°)</h6>
<div class="paragraph">
<p>Indicates when the card has been removes from <code>OperatorFabric</code> system. Technical inforation manage by <code>OperatorFabric</code>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_user_destined_information_of_the_card">User destined Information of the card</h5>
<div class="paragraph">
<p>There are two kind of User destined information in a card. Some are restricted to the card format, others are defined by the publisher as long as there are encoded in <code>json</code> format.</p>
</div>
<div class="sect5">
<h6 id="_in_card_format">in Card Format</h6>
<div class="sect6">
<h7 id="_title_title">Title (<code>title</code>)</h7>
<div class="paragraph">
<p><a href="#cardTitle">see Title in Technical Information of the Card</a></p>
</div>
</div>
<div class="sect6">
<h7 id="_summary_summary">Summary (<code>summary</code>)</h7>
<div class="paragraph">
<p><a href="#cardSummary">see Summary in Technical Information of the Card</a></p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_custome_part">Custome part</h6>
<div class="sect6">
<h7 id="_data_data">Data (<code>data</code>)</h7>
<div class="paragraph">
<p>Determines where custome information is store. The content in this attribute, is purely <code>publisher</code> choice. This content, as long as it&#8217;s in <code>json</code> format can be used to display details. For the way the details are displayed <a href="#_presentation_information_of_the_card">see below</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_presentation_information_of_the_card">Presentation Information of the card</h5>
<div class="sect5">
<h6 id="_media_media">Media (<code>media</code>)</h6>
<div class="paragraph">
<p>Some cards can emit a sound when displayed in the feed of the GUI, the id of audio notification is indicated in this attribute.</p>
</div>
</div>
<div class="sect5">
<h6 id="_details_details">details (<code>details</code>)</h6>
<div class="paragraph">
<p>This attribute is a string of objects containing a <code>title</code> attribute whichi is <code>i18n</code> key and a <code>template</code> attribute which referes to a template name contained in the publisher bundle. The bundle in which those resources will be looked for is the one corresponding of the <a href="#_card_publisher_version">version</a> declared in the card for the current <a href="#_card_publisher">publisher</a>. If no resource is found, either because there is no bundle for the given version or there is no resource for the given key, then the corresponding key is displayed in the details section of the GUI.</p>
</div>
<div class="paragraph">
<p><a href="../../../thirds/0.1.1.RELEASE/reference/#_bundle">See the documentation about third bundle in the Third service documentation</a>.</p>
</div>
<div class="paragraph">
<p><strong>example:</strong></p>
</div>
<div class="paragraph">
<p>The <code>TEST</code> publisher has only a <code>0.1</code> version uploaded in the current <code>OperatorFabric</code> system. The <code>details</code> value is <code>[{"title":{"key":"first.tab.title"},"template":"template0"}]</code>.</p>
</div>
<div class="paragraph">
<p>If the <code>publisherVersion</code> of the card is <code>2</code> then only the <code>title</code> key declared in the <code>details</code> array will be displays without any translation, i.e. the tab will contains <code>TEST.2.first.tab.title</code> and will be empty. If the <code>l10n</code> for the title is not available, then the tab title will be still <code>TEST.2.first.tab.title</code> but the template will be compute and the details section will display the template content.</p>
</div>
</div>
<div class="sect5">
<h6 id="_timespans_timespans">TimeSpans (<code>timeSpans</code>)</h6>
<div class="paragraph">
<p>When the simple startDate and endDate are not enough to characterize your
process business times, you can add a list of TimeSpan to your card. TimeSpans
are rendered in the timeline component as cluster bubbles are as lines
depending on your parametrization of the span. This as no effect on the feed
content</p>
</div>
<div class="paragraph">
<p><strong>example 1:</strong></p>
</div>
<div class="paragraph">
<p>to display the card two times in the timeline you can add two TimeSpan to your
card:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"TSO1",
	"publisherVersion":"0.1",
	"processId":"process-000",
	"startDate":"1546297200000",
	"severity":"NOTIFICATION",
	...
	"timeSpans" : [
        {"start" : 1546297200000},
        {"start" : 1546297500000},
    ]

}</pre>
</div>
</div>
<div class="paragraph">
<p>In this sample, the card will be displayed twice in the time line. The card
start date will be ignored.</p>
</div>
<div class="paragraph">
<p><strong>example 2:</strong></p>
</div>
<div class="paragraph">
<p>Instead of the default clustered view, you may want your card to be displayed
as a line in the time line.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"TSO1",
	"publisherVersion":"0.1",
	"processId":"process-000",
	"startDate":"1546297200000",
	"severity":"NOTIFICATION",
	...
	"timeSpans" : [
        {"start" : 1546297200000, "end" : 1546297500000},
    ]

}</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_publication_rest_api_overview">3.2.3. Publication REST API Overview.</h4>
<div class="sect4">
<h5 id="_publish_cards">Publish Cards</h5>
<div class="paragraph">
<p>As <a href="#_publish_card">seen here</a> the main publication method is to post Card using an http <code>POST</code> method to the endpoint <code>/cards</code> with a card as <code>json</code> object in the body of the request.</p>
</div>
<div class="paragraph">
<p>There is an asynchrone metho available whom end-point is <code>/async/cards</code>. The response for this method is always a <code>201</code> status, no matter what the card is accepted or not.</p>
</div>
</div>
<div class="sect4">
<h5 id="_delete_cards">Delete Cards</h5>
<div class="paragraph">
<p>For a given <code>process id</code> it&#8217;s possible to delete the current card (not the archived ones), using the <code>DELETE</code> http method with the following end-point <code>/cards/{processId}</code> where <code>processId</code> is the id of the choosen process. In <code>OperatorFabric</code> calling this method will trigger a <code>DELETE CardOperation</code> with the <code>id</code> of the current card linked to the request process.</p>
</div>
</div>
<div class="sect4">
<h5 id="_other_methods">Other methods</h5>
<div class="paragraph">
<p>The other methods declared in the <a href="../api/">Card Management</a> are used by the GUI and are parts of the <code>Card Consultation API</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_card_consultation_service_reference_documentation_2">3.3. Card Consultation Service Reference Documentation</h3>
<div class="paragraph">
<p>WORK in progress</p>
</div>
<div class="sect3">
<h4 id="_archived_cards">3.3.1. Archived Cards</h4>
<div class="sect4">
<h5 id="_key_concepts">Key concepts</h5>
<div class="paragraph">
<p>Every time a card is published, in addition to being delivered to the users
and persisted as a "current" card in MongoDB, it is also immediately
persisted in the archived cards.</p>
</div>
<div class="paragraph">
<p>Archived cards are similar in structure to current cards, but they are managed differently.
Current cards are uniquely identified by their id (made up of the publisher and the process id).
That is because if a new card is published with id as an existing card, it will replace it in the
card collection. This way, the current card reflects the current state of a process instance.
In the archived cards collection however, both cards will be kept, so that the archived cards
show all the states that a given process instance went through.</p>
</div>
</div>
<div class="sect4">
<h5 id="_archives_screen_in_the_ui">Archives screen in the UI</h5>
<div class="paragraph">
<p>The Archives screen in the UI allows the users to query these archives with different filters.
The layout of this screen is very similar to the Feed screen: the results are displayed in a
(paginated) card list, and the user can display the associated card details by clicking a card in the list.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The results of these queries are limited to cards that the user is allowed to see, either
because they are direct recipient of the card or because they belong to a group that is a recipient
of the card.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_archive_endpoints_in_the_card_consultation_api">Archive endpoints in the card-consultation API</h5>
<div class="paragraph">
<p>This Archives screen relies on dedicated endpoints in the card-consultation API, as described
<a href="https://opfab.github.io/projects/services/core/cards-consultation/0.11.1.SNAPSHOT/api/#Archives">here</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_operatorfabric_third_service">3.4. OperatorFabric Third service</h3>
<div class="paragraph">
<p>Third service is used by third party service to customize some parts of OperatorFabric to fit their needs.
It allows to refine Operator Fabric behavior regarding:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Published card details rendering</p>
</li>
<li>
<p>Card available actions and rendering</p>
</li>
<li>
<p>I18n resources for card rendering</p>
</li>
<li>
<p>Additional menu entries</p>
</li>
<li>
<p>Notification sound (not yet implemented)</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_declaring_a_third_party_service">3.4.1. Declaring a Third Party Service</h4>
<div class="paragraph">
<p>This sections explains Third Party Service Configuration</p>
</div>
<div class="paragraph">
<p>The third party service configuration is declaredusing a bundle which is described below.
Once this bundle fully created, it must be uploaded to the server which will apply this configuration into current
for further web UI calls</p>
</div>
<div class="paragraph">
<p>The way configuration is done is explained throughout examples before a more technical review of the configuration details.
The following instructions describe tests to perform on OperatorFabric to understand how customization is working in it.
The card data used here are send automatically using a script as describe here <a href="#CardSendingScript">Cards sending script</a>.</p>
</div>
<div class="sect4">
<h5 id="_requirements">Requirements</h5>
<div class="paragraph">
<p>Those examples are played in an environment where an OperatorFabric instance (all micro-services) is running along
a MongoDB Database and a RabbitMQ instances.</p>
</div>
</div>
<div class="sect4">
<h5 id="_bundle">Bundle</h5>
<div class="paragraph">
<p>Third bundles customize the way third card details are displayed. Those <code>tar.gz</code> archives contain a descriptor file
named <code>config.json</code>, eventually some <code>css files</code>, <code>i18n files</code> and <code>handlebars templates</code> to do so.</p>
</div>
<div class="paragraph">
<p>For didactic purposes, in this section, the third name is <code>BUNDLE_TEST</code> (to match the parameters used by the script).
This bundle is localized for <code>en</code> and <code>fr</code>.</p>
</div>
<div class="paragraph">
<p>As detailed in the <code>Third core service README</code> the bundle contains at least a metadata file called <code>config.json</code>,
a <code>css</code> folder, an <code>media</code> folder(not create in this example), an <code>i18n</code> folder and a <code>template</code> folder.
 All, but <code>config.json file</code>, elements are optional.</p>
</div>
<div class="paragraph">
<p>The files of this example are organized as below:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>bundle
├── config.json
├── css
│   └── bundleTest.css
├── i18n
│   ├── en.json
│   └── fr.json
└── template
    ├── en
    │   ├── template1.handlebars
    │   └── template2.handlebars
    └── fr
        ├── template1.handlebars
        └── template2.handlebars</pre>
</div>
</div>
<div class="paragraph">
<p>To summarize, there are 5 directories and 8 files.</p>
</div>
<div class="sect5">
<h6 id="_the_config_json_file">The config.json file</h6>
<div class="paragraph">
<p>It&#8217;s a description file in <code>json</code> format. It lists the content of the bundle.</p>
</div>
<div class="paragraph">
<p><strong>example</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
  "name": "BUNDLE_TEST",
  "version": "1",
  "csses": [
    "bundleTest"
  ],
  "i18nLabelKey": "third-name-in-menu-bar",
  "menuEntries": [
    {
      "id": "uid test 0",
      "url": "https://opfab.github.io/whatisopfab/",
      "label": "first-menu-entry"
    },
    {
      "id": "uid test 0",
      "url": "https://www.lfenergy.org/",
      "label": "b-menu-entry"
    },
    {
      "id": "uid test 1",
      "url": "https://github.com/opfab/opfab.github.io",
      "label": "the-other-menu-entry"
    }
  ],
  "processes" : {
      "simpleProcess" : {
        "start" : {
          "details" : [ {
            "title" : {
              "key" : "start.first.title"
            },
            "titleStyle" : "startTitle text-danger",
            "templateName" : "template1"
          } ],
          "actions" : {
            "finish" : {
              "type" : "URI",
              "url": "http://somewher.org/simpleProcess/finish
              "lockAction" : true,
              "lockCard" : true,
              "needsConfirm" : false,
              "called" : false,
              "updateState" : false,
              "updateStateBeforeAction" : false,
              "hidden" : true,
              "contentStyle" : "buttonContentClass",
              "buttonStyle" : "buttonClass",
              "label" : {
                "key" : "my.card.my.action.label"
              },
              "inputs" : [ {
                "type" : "TEXT",
                "label" : { "key" : "simple-process.finsih.comment" },
                "mandatory" : true,
                "name" : "comment"
              } ]
            }
          }
        },
        "end" : {
          "details" : [ {
            "title" : {
              "key" : "end.first.title"
            },
            "titleStyle" : "startTitle text-info",
            "templateName" : "template2",
            "styles" : [ "bundleTest.css" ]
          } ]
        }
      }
    }
}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>name: third name;</p>
</li>
<li>
<p>version: enable the correct display even the old ones as all version are stored by the server you <strong>card</strong> as a version
field that will be matched to third configuration for correct rendering ;</p>
</li>
<li>
<p>processes : list the available processes and their possible states; actions and templates are associated to states</p>
</li>
<li>
<p>css file template list as <code>csses</code>;</p>
</li>
<li>
<p>third name in the main bar menu as <code>i18nLabelKey</code>: optional, used if the third service add one or several entry in the OperatorFabric main menu bar,cf <a href="#MenuEntries">menu entries section for details</a>;</p>
</li>
<li>
<p>extra menu entries as <code>menuEntries</code>: optional, see below for the declaration format of objects of this array, cf <a href="#MenuEntries">menu entries section for details</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The mandatory declaration are <code>name</code> and <code>version</code> attributes.</p>
</div>
<div class="paragraph">
<p><a href="../api/#Third">related api details</a></p>
</div>
</div>
<div class="sect5">
<h6 id="_i18n">i18n</h6>
<div class="paragraph">
<p>There are two ways of i18n for third service. The first one is done using l10n files which are located in the <code>i18n</code> folder, the second one throuhougt l10n name folder nested in the <code>template</code> folder or in the <code>media</code> folder.</p>
</div>
<div class="paragraph">
<p>The <code>i18n</code> folder contains one json file per l10n.</p>
</div>
<div class="paragraph">
<p>These localisation is used for integration of the third service into OperatorFabric, i.e. the label displayed for the third service, the label displayed for each tab of the details of the third card, the label of the actions in cards if any or the additionnal third entries in OperatorFabric(more on that at the chapter ????).</p>
</div>
<div class="sect6">
<h7 id="_template_and_media_folders">Template and Media folders</h7>
<div class="paragraph">
<p>The <code>template</code> and the <code>media</code> folder must contain localized folder for the i18n of the card details. This is why in our example, as the bundle is localized for <code>en</code> and <code>fr</code> language, the <code>template</code> folder contains a <code>en</code> and a <code>fr</code> folder.</p>
</div>
</div>
<div class="sect6">
<h7 id="_i18n_file">i18n file</h7>
<div class="paragraph">
<p>If there is no i18n file or key is missing, the i18n key is desplayed in OperatorFabric.</p>
</div>
<div class="paragraph">
<p>The choice of i18n keys is leaved to the Third service maintainer. The keys are referenced in the following places:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>config.json</code> file:</p>
<div class="ulist">
<ul>
<li>
<p><code>i18nLabelKey</code>: key used for the label for the third service displayed in the main menu bar of OperatorFabric;</p>
</li>
<li>
<p><code>label</code> of <code>menu entry declaration</code>: key used to l10n the <code>menu entries</code> declared by the Third party in the bundle;</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>card data</code>: values of <code>card title</code> and <code>card summary</code> refer to <code>i18n keys</code> as well as <code>key attribute</code> in the <code>carde detail</code> section of the card data.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>example</strong></p>
</div>
<div class="paragraph">
<p>So in this example the third service is named <code>Bundle Test</code> with <code>BUNDLE_TEST</code> technical name. The bundle provide an english and a french l10n.</p>
</div>
<div class="paragraph">
<p>The example bundle defined an new menu entry given acces to 3 entries. The title and the summary have to be l10n, so needs to be the 2 tabs titles.</p>
</div>
<div class="paragraph">
<p>The name of the third service as displayed in the main menu bar of OperatorFabric. It will have the key <code>"third-name-in-menu-bar"</code>. The english l10n will be <code>Bundle Test</code> and the french one will be <code>Bundle de test</code>.</p>
</div>
<div class="paragraph">
<p>A name for the three entries in the third entry menu. Their keys will be in order <code>"first-menu-entry"</code>, <code>"b-menu-entry"</code> and <code>"the-other-menu-entry"</code> for an english l10n as <code>Entry One</code>, <code>Entry Two</code> and <code>Entry Three</code> and in french as <code>Entrée une</code>, <code>Entrée deux</code> and <code>Entrée trois</code>.</p>
</div>
<div class="paragraph">
<p>The title for the card and its summary. As the card used here are generated by the script of the <code>cards-publication</code> project we have to used the key declared there. So they are respectively <code>process.title</code> and <code>process.summary</code> with the following l10ns for english: <code>Card Title</code> and <code>Card short description</code>, and for french l10ns: <code>Titre de la carte</code> and <code>Courte description de la carte</code>.</p>
</div>
<div class="paragraph">
<p>A title for earch (two of them) tab of the detail cards. As for card title and card summary, those key are already define by the test script. There are <code>"process.detail.tab.first"</code> and <code>"process.detail.tab.second"</code>. For english l10n the values are <code>First Detail List</code> and <code>Second Detail List</code> and for the french l10n, the values are <code>Première liste de détails</code> and <code>Seconde liste de détails</code>.</p>
</div>
<div class="paragraph">
<p>Here is the content of <code>en.json</code></p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"third-name-in-menu-bar":"Bundle Test",
		"first-menu-entry":"Entry One",
		"b-menu-entry":"Entry Two",
		"the-other-menu-entry":"Entry Three",
		"process":{
			"title":"Card Title",
			"summary":"Card short description",
			"detail":{
				"tab":{
					"first":"First Detail List",
					"second":"Second Detail List"
				}
			}
		}
}</pre>
</div>
</div>
<div class="paragraph">
<p>Here the content of <code>fr.json</code></p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"third-name-in-menu-bar":"Bundle de test",
		"first-menu-entry":"Entrée une",
		"b-menu-entry":"Entrée deux",
		"the-other-menu-entry":"Entrée trois",
		"process":{
			"title":"Titre de la carte",
			"summary":"Courte description de la carte",
			"detail":{
				"tab":{
					"first":"Première liste de détails",
					"second":"Deuxième liste de détails"
				}
			}
		}
}</pre>
</div>
</div>
<div class="paragraph">
<p>Once the bundle correctly upload, the way to verify if the i18n have been correctly uploaded it&#8217;s to used the GET method of third api for i18n file.</p>
</div>
<div class="paragraph">
<p>The service is describe <a href="../api/<mark>getI18n">here</a> and can be used directly in the browser usinge the <a href="http://localhost:2100/swagger-ui.html</mark>/thirds/getI18n">Swagger UI - Third get i18n</a>. The <code>locale</code> language, the <code>version</code> of the bundle and the <code>technical name</code> of the third party are needed to get json in the response.</p>
</div>
<div class="paragraph">
<p>To verify if the french l10n data of the version 1 of the BUNDLE_TEST third party we could use the following command line <code>curl -X GET "http://localhost:2100/thirds/BUNDLE_TEST/i18n?locale=fr&amp;version=1" -H  "accept: application/json"</code>.
The service response with a 200 status and with the json correpsonding to the defined fr.json file show below.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
"third-name-in-menu-bar":"Bundle de test",
"first-menu-entry":"Entrée une",
"b-menu-entry":"Entrée deux",
"the-other-menu-entry":"Entrée trois",
"tests":{
	"title":"Titre de la carte",
	"summary":"Courte description de la carte",
	"detail":{
		"tab":{
			"first":"Première liste de détails",
			"second":"Deuxième liste de détails"
			}
		}
}
}</pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="MenuEntries">Menu Entries</h6>
<div class="paragraph">
<p>Those elements are declared  in the <code>config.json</code> file of the bundle.</p>
</div>
<div class="paragraph">
<p>If there are several items to declare for a third service, a title for the third menu section need to be declared within the <code>i18nLabelKey</code> attribut, otherwise the first and only <code>menu entry</code> item is used to create an entry in the menu nav bar of OperatorFabric.</p>
</div>
<div class="sect6">
<h7 id="_config_json_declaration">config.json declaration</h7>
<div class="paragraph">
<p>This kind of objects contains the following attributes :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>id</code>: identifier of the entry menu in the UI;</p>
</li>
<li>
<p><code>url</code>: url openning a new page in a tab in the browser;</p>
</li>
<li>
<p><code>label</code>: it&#8217;s an i18n key used to l10n the entry in the UI.</p>
</li>
</ul>
</div>
<div class="sect7">
<h8 id="_examples">Examples</h8>
<div class="paragraph">
<p>In the following examples, only the part relative to menu entries in the <code>config.json</code> file is detailed, the other parts are omitted and represent with a '…'.</p>
</div>
<div class="paragraph">
<p><strong>Single menu entry</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	…
	"menuEntries":[{
			"id": "identifer-single-menu-entry",
			"url": "https://opfab.github.io",
			"label": "single-menu-entry-i18n-key"
		}],
}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Several menu entries</strong></p>
</div>
<div class="paragraph">
<p>Here a sample with 3 menu entries.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	…
	"i18nLabelKey":"third-name-in-menu-navbar",
	"menuEntries": [{
			"id": "firstEntryIdentifier",
			"url": "https://opfab.github.io/whatisopfab/",
			"label": "first-menu-entry"
		},
		{
			"id": "secondEntryIdentifier",
			"url": "https://www.lfenergy.org/",
			"label": "second-menu-entry"
		} ,
		{
			"id": "thirdEntryIdentifier",
			"url": "https://opfab.github.io",
			"label": "third-menu-entry"
		}]
}</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_processes_and_states">Processes and States</h6>
<div class="paragraph">
<p>Processes and their states allows to match a Third Party service process specific state to a list of templates for card details and
actions allowing specific card rendering for each state of the business process.</p>
</div>
<div class="paragraph">
<p>The purpose of this section is to display elements of third card data in a custom format.</p>
</div>
<div class="paragraph">
<p>Regarding the card detail customization, all the examples in this section will be based on the cards generated by the script existing in the <code>Cards-Publication</code> project. For the examples given here, this script is run with arguments detail in the following command line:</p>
</div>
<div id="CardSendingScript" class="literalblock">
<div class="content">
<pre>$OPERATOR_FABRIC_HOME/services/core/cards-publication/src/main/bin/push_card_loop.sh --publisher BUNDLE_TEST --process tests</pre>
</div>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>$OPERATOR_FABRIC_HOME</code> is the root folder of OperatorFabric where tests are performed;</p>
</li>
<li>
<p><code>BUNDLE_TEST</code> is the name of the Third party;</p>
</li>
<li>
<p><code>tests</code> is the name of the process refered by published cards.</p>
</li>
</ul>
</div>
<div class="sect6">
<h7 id="_configuration_2">configuration</h7>
<div class="paragraph">
<p>The process entry in the configuration file is a dictionary of processes, each key maps to a process definition.
A process definition is itself a dictionary of states, each key maps to a state definition. A state is define by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a list of details: details are a combination of an internationnalized title (tile), css class styling element
(titleStyle) and a template reference</p>
</li>
<li>
<p>a dictionary of actions: actions are described in the bellow <a href="#ActionsThirdsDesfription">Actions</a> section.</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="ActionsThirdsDesfription">Actions</h7>
<div class="literalblock">
<div class="content">
<pre>{
  "type" : "URI",
  "url": "http://somewher.org/simpleProcess/finish
  "lockAction" : true,
  "lockCard" : true,
  "needsConfirm" : false,
  "called" : false,
  "updateState" : false,
  "updateStateBeforeAction" : false,
  "hidden" : true,
  "contentStyle" : "buttonContentClass",
  "buttonStyle" : "buttonClass",
  "label" : {
    "key" : "my.card.my.action.label"
  },
  "inputs" : [ {
    "type" : "TEXT",
    "label" : { "key" : "simple-process.finsih.comment" },
    "mandatory" : true,
    "name" : "comment"
  } ]
}</pre>
</div>
</div>
<div class="paragraph">
<p>An action aggregates both the mean to trigger action on the third party and data for an action button rendering:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>type - mandatory: for now only URL type is supported:</p>
<div class="ulist">
<ul>
<li>
<p>URL: this action triggers a call to an external REST end point</p>
</li>
</ul>
</div>
</li>
<li>
<p>url - mandatory: a templated url for URL type action. this url may be injected with data before actions call, data are
specified using curly brackets. Available parameters:</p>
<div class="ulist">
<ul>
<li>
<p>processInstance: the name/id of the process instance</p>
</li>
<li>
<p>process: the name of the process</p>
</li>
<li>
<p>state: the state name of the process</p>
</li>
<li>
<p>jwt: the jwt token of the user</p>
</li>
<li>
<p>data.[path]: a path to object in card data structure</p>
</li>
</ul>
</div>
</li>
<li>
<p>hidden: if true, action won&#8217;t be visible on the card but will be available to templates</p>
</li>
<li>
<p>contentStyle: css style classes to apply to the content of the action button</p>
</li>
<li>
<p>buttonStyle: css style classes to apply to the action button</p>
</li>
<li>
<p>label: an i18n key and parameters used to display a tooltip over the button</p>
</li>
<li>
<p>lockAction: not yet implemented</p>
</li>
<li>
<p>lockCard: not yet implemented</p>
</li>
<li>
<p>updateState: not yet implemented</p>
</li>
<li>
<p>updateState: not yet implemented</p>
</li>
<li>
<p>updateStateBeforeAction: not yet implemented</p>
</li>
<li>
<p>called: not yet implemented</p>
</li>
<li>
<p>inputs: input parameters for action submission. Not yet implemented.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For in depth information on the behavior needed for the third party rest endpoints refer to the Actions service reference.</p>
</div>
</div>
<div class="sect6">
<h7 id="_templates">Templates</h7>
<div class="paragraph">
<p>For demonstration purposes, there will be two simple templates. For more advance feature go to the section detailing the handlebars templates in general and helpers available in OperatorFabric.
As the card used in this example are created <a href="#CardSendingScript">above</a>, the bundle template folder needs to contain 2 templates: <code>template1.handlebars</code> and <code>template2.handlebars</code>.</p>
</div>
<div class="paragraph">
<p>examples of template (i18n versions)</p>
</div>
<div class="paragraph">
<p><code>/template/en/template1.handlers</code></p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;h2&gt;Template Number One&lt;/h2&gt;
&lt;div class="bundle-test"&gt;'{{card.data.level1.level1Prop}}'&lt;/div&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><code>/template/fr/template1.handlers</code></p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;h2&gt;Patron numéro Un&lt;/h2&gt;
&lt;div class="bundle-test"&gt;'{{card.data.level1.level1Prop}}'&lt;/div&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Those templates display a l10n title and an line containing the value of the scope property <code>card.level1.level1Prop</code> which is <code>This is a root property</code>.</p>
</div>
<div class="paragraph">
<p><code>/template/en/template2.handelbars</code></p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;h2&gt;Second Template&lt;/h2&gt;
&lt;ul class="bundle-test-list"&gt;
	{{#each card.data.level1.level1Array}}
		&lt;li class="bunle-test-list-item"&gt;{{this.level1ArrayProp}}&lt;/li&gt;
	{{/each}}
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><code>/template/fr/template2.handelbars</code></p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;h2&gt;Second patron&lt;/h2&gt;
&lt;ul class="bundle-test-list"&gt;
	{{#each card.data.level1.level1Array}}
		&lt;li class="bunle-test-list-item"&gt;{{this.level1ArrayProp}}&lt;/li&gt;
	{{/each}}
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Those templates display also a l10n title and a list of numeric values from 1 to 3.</p>
</div>
</div>
<div class="sect6">
<h7 id="_css">CSS</h7>
<div class="paragraph">
<p>This folder contains regular css files.
The file name must be declared in the <code>config.json</code> file in order to be used in the templates and applyed to them.</p>
</div>
<div class="sect7">
<h8 id="_examples_2">Examples</h8>
<div class="paragraph">
<p>As above, all parts of files unreleavant for our example are symbolise by a <code>…</code> character.</p>
</div>
<div class="paragraph">
<p><strong>Declaration of css files in <code>config.json</code> file</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	…
	"csses":["bundleTest"]
	…
}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>CSS Class used in <code>./template/en/template1.handlebars</code></strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>	…
	&lt;div class="bundle-test"&gt;'{{card.data.level1.level1Prop}}'&lt;/div&gt;
	…</pre>
</div>
</div>
<div class="paragraph">
<p>As seen abow, the value of <code>{{card.data.level1.level1Prop}}</code> of a test card is <code>This is a level1 property</code></p>
</div>
<div class="paragraph">
<p><strong>Style declaration in <code>./css/bundleTest.css</code></strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>.h2{
	color:#fd9312;
	font-weight: bold;
}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected result</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/expected-result.png" alt="Formatted root property">
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_upload">Upload</h6>
<div class="paragraph">
<p>For this, the bundle is submitted to the OperatorFabric server using a POST http method as describe in <a href="../api/<mark>uploadBundle">the Third Service API documentation</a>.
It&#8217;s possible for test purposes to use the swagger documentation of the OperatorFabric using the folling url <code>https//:$OPERATOR_FABRIC_ROOT_URL:2100/swagger-ui.html</mark>/thirds/uploadBundle</code></p>
</div>
<div class="paragraph">
<p> where <code>$OPERATOR_FABRIC_ROOT_URL</code> is the url of the running OperatorFabric tested.</p>
</div>
<div class="paragraph">
<p>Example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd $BUNDLE_FOLDER
curl -X POST "http://localhost:2100/thirds" -H  "accept: application/json" -H  "Content-Type: multipart/form-data" -F "file=@bundle-test.tar.gz;type=application/gzip"</pre>
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>$BUNDLE_FOLDER</code> is the folder containing the bundle archive to be uploaded.</p>
</li>
<li>
<p><code>bundle-test.tar.g</code> is the name of the uploaded bundle.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These command line should return a <code>200 http status</code> response with the details of the content of the bundle in the response body such as :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
  "mediasData": null,
  "menuEntriesData": [
    {
      "id": "uid test 0",
      "url": "https://opfab.github.io/whatisopfab/",
      "label": "first-menu-entry"
    },
    {
      "id": "uid test 0",
      "url": "https://www.lfenergy.org/",
      "label": "b-menu-entry"
    },
    {
      "id": "uid test 1",
      "url": "https://github.com/opfab/opfab.github.io",
      "label": "the-other-menu-entry"
    }
  ],
  "name": "BUNDLE_TEST",
  "version": "1",
  "csses": [
    "bundleTest"
  ],
  "i18nLabelKey": "third-name-in-menu-bar",
  "medias": null,
  "menuEntries": [
    {
      "id": "uid test 0",
      "url": "https://opfab.github.io/whatisopfab/",
      "label": "first-menu-entry"
    },
    {
      "id": "uid test 0",
      "url": "https://www.lfenergy.org/",
      "label": "b-menu-entry"
    },
    {
      "id": "uid test 1",
      "url": "https://github.com/opfab/opfab.github.io",
      "label": "the-other-menu-entry"
    }
  ],
  "processes" : {
        "simpleProcess" : {
          "start" : {
            "details" : [ {
              "title" : {
                "key" : "start.first.title"
              },
              "titleStyle" : "startTitle text-danger",
              "templateName" : "template1"
            } ],
            "actions" : {
              "finish" : {
                "type" : "URI",
                "url": "http://somewher.org/simpleProcess/finish
                "lockAction" : true,
                "lockCard" : true,
                "needsConfirm" : false,
                "called" : false,
                "updateState" : false,
                "updateStateBeforeAction" : false,
                "hidden" : true,
                "contentStyle" : "buttonContentClass",
                "buttonStyle" : "buttonClass",
                "label" : {
                  "key" : "my.card.my.action.label"
                },
                "inputs" : [ {
                  "type" : "TEXT",
                  "label" : { "key" : "simple-process.finsih.comment" },
                  "mandatory" : true,
                  "name" : "comment"
                } ]
              }
            }
          },
          "end" : {
            "details" : [ {
              "title" : {
                "key" : "end.first.title"
              },
              "titleStyle" : "startTitle text-info",
              "templateName" : "template2",
              "styles" : [ "bundleTest.css" ]
            } ]
          }
        }
      }
}</pre>
</div>
</div>
<div class="paragraph">
<p>Otherwise please refer to the <a href="#TroubleShooting">trouble shooting</a> section to resolve the problem.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_technical_overview">3.4.2. Technical overview</h4>
<div class="paragraph">
<p>See <a href="../api/#__Models">the model section of the swagger generated
documentation</a> for data layout</p>
</div>
<div class="sect4">
<h5 id="resource-serving">Resource serving</h5>
<div class="sect5">
<h6 id="css">CSS</h6>
<div class="paragraph">
<p>CSS 3 style sheet are supported, they allow custom styling of card template
detail all css selector must be prefixed by the <code>.detail.template</code> parent
selector</p>
</div>
</div>
<div class="sect5">
<h6 id="internationalization">Internationalization</h6>
<div class="paragraph">
<p>Internationalization (i18n) files are json file (JavaScript Object Notation).
One file must be defined by module supported language. See
<a href="../api/#__Models">the model section of the swagger
generated documentation</a> for data layout.</p>
</div>
<div class="paragraph">
<p>Sample json i18n file</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{ "emergency":
  {
    "message": "Emergency situation happened on {{date}}. Cause : {{cause}}."
    "module":
      {
        "name": "Emergency Module",
        "description": "The emergency module managed ermergencies"
      }
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>i18n messages may include parameters, these parameters are framed with double
curly braces.</p>
</div>
<div class="paragraph">
<p>The bundled json files name must conform to the following pattern : [lang].json</p>
</div>
<div class="paragraph">
<p>ex:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>fr.json
en.json
de.json</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="media-notification-sounds">Media (notification sounds)</h6>
<div class="paragraph">
<p>Supported media files type : * ogg * wav * mp3</p>
</div>
<div class="paragraph">
<p>Due to web nature of Operator Fabric, we encourage business modules provider to
favor the lightest file formats (ogg,mp3, &#8230;&#8203;)</p>
</div>
</div>
<div class="sect5">
<h6 id="templates">Templates</h6>
<div class="paragraph">
<p>Templates are <a href="https://handlebarsjs.com/">Handlebars</a> template files. Templates
are fuelled with a scope structure composed of</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <strong>card</strong> property (See <a href="../api/#__Models">card data model</a> for more information)</p>
</li>
<li>
<p>a <strong>userContext</strong> :</p>
<div class="ulist">
<ul>
<li>
<p><strong>login</strong>: user login</p>
</li>
<li>
<p><strong>token</strong>: user jwt token</p>
</li>
<li>
<p><strong>firstName</strong>: user first name</p>
</li>
<li>
<p><strong>lastName</strong>: user last name</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to Handlebars basic syntax and helpers, Operator Fabric defines the
following helpers :</p>
</div>
<div class="sect6">
<h7 id="numberformat">numberFormat</h7>
<div class="paragraph">
<p>formats a number parameter using
<a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Objets_globaux/Nu" class="bare">developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Objets_globaux/Nu</a>
mberFormat[Intl.NumberFormat].
The locale used is the current user selected one, and options are passed as hash
parameters (<a href="https://handlebarsjs.com/">see Handlebars doc Literals section</a>).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{numberFormat card.data.price style="currency" currency="EUR"}}</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="dateformat">dateFormat</h7>
<div class="paragraph">
<p>formats the submitted parameters (millisecond since epoch) using
<a href="https://momentjs.com/">mement.format</a>. The locale used is the current user
selected one, the format is "format" hash parameter
(<a href="https://handlebarsjs.com/">see Handlebars doc Literals section</a>).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{dateFormat card.data.birthday format="MMMM Do YYYY, h:mm:ss a"}}</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="slice">slice</h7>
<div class="paragraph">
<p>extracts a sub array from ann array</p>
</div>
<div class="paragraph">
<p>example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!--
{"array": ["foo","bar","baz"]}
--&gt;
&lt;ul&gt;
{{#each (slice array 0 2)}}
  &lt;li&gt;{{this}}&lt;/li&gt;
{{/each}}
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
  &lt;li&gt;foo&lt;/li&gt;
  &lt;li&gt;bar&lt;/li&gt;
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!--
{"array": ["foo","bar","baz"]}
--&gt;
&lt;ul&gt;
{{#each (slice array 1)}}
  &lt;li&gt;{{this}}&lt;/li&gt;
{{/each}}
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
  &lt;li&gt;bar&lt;/li&gt;
  &lt;li&gt;baz&lt;/li&gt;
&lt;/ul&gt;</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="now">now</h7>
<div class="paragraph">
<p>outputs the current date in millisecond from epoch. The date is computed from
application internal time service and thus may be different from the date that
one can compute from javascript api which relies on the browsers' system time.</p>
</div>
<div class="paragraph">
<p>NB: Due to Handlebars limitation you must provide at least one argument to
helpers otherwise, Handlebars will confuse a helper and a variable. In the
bellow example, we simply pass an empty string.</p>
</div>
<div class="paragraph">
<p>example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;div&gt;{{now ""}}&lt;/div&gt;
&lt;br&gt;
&lt;div&gt;{{dateFormat (now "") format="MMMM Do YYYY, h:mm:ss a"}}&lt;/div&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;div&gt;1551454795179&lt;/div&gt;
&lt;br&gt;
&lt;div&gt;mars 1er 2019, 4:39:55 pm&lt;/div&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>for a local set to <code>FR_fr</code></p>
</div>
</div>
<div class="sect6">
<h7 id="preservespace">preserveSpace</h7>
<div class="paragraph">
<p>preserves space in parameter string to avoid html standard space trimming.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{preserveSpace card.data.businessId}}</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="bool">bool</h7>
<div class="paragraph">
<p>returns a boolean result value on an arithmetical operation (including object
equality) or boolean operation.</p>
</div>
<div class="paragraph">
<p>Arguments: - v1: left value operand - op: operator (string value) - v2: right
value operand</p>
</div>
<div class="paragraph">
<p>arithmetical operators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>==</p>
</li>
<li>
<p>===</p>
</li>
<li>
<p>!=</p>
</li>
<li>
<p>!==</p>
</li>
<li>
<p>&lt;</p>
</li>
<li>
<p>&#8656;</p>
</li>
<li>
<p>&gt;</p>
</li>
<li>
<p>&gt;=</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>boolean operators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&amp;&amp;</p>
</li>
<li>
<p>||</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>examples:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{#if (bool v1 '&lt;' v2)}}
  v1 is strictly lower than v2
{{else}}
 V2 is lower or equal to v1
{{/if}}</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="math">math</h7>
<div class="paragraph">
<p>returns the result of a mathematical operation.</p>
</div>
<div class="paragraph">
<p>arguments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>v1: left value operand</p>
</li>
<li>
<p>op: operator (string value)</p>
</li>
<li>
<p>v2: right value operand</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>arithmetical operators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>+</p>
</li>
<li>
<p>-</p>
</li>
<li>
<p>*</p>
</li>
<li>
<p>/</p>
</li>
<li>
<p>%</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{math 1 '+' 2}}</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="split">split</h7>
<div class="paragraph">
<p>splits a string into an array based on a split string.</p>
</div>
<div class="paragraph">
<p>example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
{{#each (split 'my.example.string' '.')}}
  &lt;li&gt;{{this}}&lt;/li&gt;
{{/each}}
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
  &lt;li&gt;my&lt;/li&gt;
  &lt;li&gt;example&lt;/li&gt;
  &lt;li&gt;string&lt;/li&gt;
&lt;/ul&gt;</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="cardaction">action</h7>
<div class="paragraph">
<p>outputs a card action button whose card action id is the concatenation of an
arbitrary number of helper arguments</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{{action "PREREQUISITE_" id}}}</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="svg">svg</h7>
<div class="paragraph">
<p>outputs a svg tag with lazy loading, and missing image replacement message. The
image url is the concatenation of an arbitrary number of helper arguments</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{{svg baseUri scheduledOpId "/" substation "/before/"
computationPhaseOrdinal}}}</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="i18n">i18n</h7>
<div class="paragraph">
<p>outputs a i18n result from a key and some parameters. There are two ways of
configuration :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pass an object as sole argument. The object must contain a key field (string)
and an optional parameter field (map of parameterKey &#8658; value)</p>
<div class="literalblock">
<div class="content">
<pre>{{i18n card.data.i18nTitle}}</pre>
</div>
</div>
</li>
<li>
<p>Pass a string key as sole argument and use hash parameters
(<a href="https://handlebarsjs.com/">see Handlebars doc Literals section</a>) for i18n string
parameters.</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!--
emergency.title=Emergency situation happened on {{date}}. Cause : {{cause}}.
--&gt;
{{i18n "emergency.title" date="2018-06-14" cause="Broken Cofee Machine"}}</pre>
</div>
</div>
<div class="paragraph">
<p>outputs</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Emergency situation happened on 2018-06-14. Cause : Broken Cofee Machine</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="sort">sort</h7>
<div class="paragraph">
<p>sorts an array or some object&#8217;s properties (first argument) using an optional
field name (second argument) to sort the collection on this fields natural
order.</p>
</div>
<div class="paragraph">
<p>If there is no field argument provided :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>for an array, the original order of the array is kept ;</p>
</li>
<li>
<p>for an object, the structure is sorted by the object field name.</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!--
users :

{"john": { "firstName": "John", "lastName": "Cleese"},
"graham": { "firstName": "Graham", "lastName": "Chapman"},
"terry": { "firstName": "Terry", "lastName": "Gilliam"},
"eric": { "firstName": "Eric", "lastName": "Idle"},
"terry": { "firstName": "Terry", "lastName": "Jones"},
"michael": { "firstName": "Michael", "lastName": "Palin"},
--&gt;

&lt;ul&gt;
{{#each (sort users)}}
    &lt;li&gt;{{this.firstName}} {{this.lastName}}&lt;/li&gt;
{{/each}}
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
  &lt;li&gt;Eric Idle&lt;/li&gt;
  &lt;li&gt;Graham Chapman&lt;/li&gt;
  &lt;li&gt;John Cleese&lt;/li&gt;
  &lt;li&gt;Michael Pallin&lt;/li&gt;
  &lt;li&gt;Terry Gilliam&lt;/li&gt;
  &lt;li&gt;Terry Jones&lt;/li&gt;
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
{{#each (sort users "lastName")}}
    &lt;li&gt;{{this.firstName}} {{this.lastName&lt;/li&gt;
{{/each}}
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
  &lt;li&gt;Graham Chapman&lt;/li&gt;
  &lt;li&gt;John Cleese&lt;/li&gt;
  &lt;li&gt;Terry Gilliam&lt;/li&gt;
  &lt;li&gt;Eric Idle&lt;/li&gt;
  &lt;li&gt;Terry Jones&lt;/li&gt;
  &lt;li&gt;Michael Pallin&lt;/li&gt;
&lt;/ul&gt;</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="TroubleShooting">3.4.3. Troubleshooting</h4>
<div class="sect4">
<h5 id="_my_bundle_is_not_loaded">My bundle is not loaded</h5>
<div class="paragraph">
<p>The server send a <code>{"status":"BAD_REQUEST","message":"unable to open submitted
file","errors":["Error detected parsing the header"]}</code>, despite correct http
headers.</p>
</div>
<div class="paragraph">
<p>The uploaded bundle is corrupted. Test your bundle in a terminal (Linux
solution)</p>
</div>
<div class="paragraph">
<p>example for a bundle archive named <code>MyBundleToTest.tar.gz</code> giving the
mentionned error when uploaded :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>tar -tzf MyBundleToTest.tar.gz &gt;/dev/null
tar: This does not look like a tar archive
tar: Skipping to next header
tar: Exiting with failure status due to previous errors</pre>
</div>
</div>
<div class="sect5">
<h6 id="_solution">Solution</h6>
<div class="paragraph">
<p>Extract content if possible and compress it to a correct compressed archive
format.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_i_cant_upload_my_bundle">I can&#8217;t upload my bundle</h5>
<div class="paragraph">
<p>The server repsonds with a message like the following:
<code>{"status":"BAD_REQUEST","message":"unable to open submitted
file","errors":["Input is not in the .gz format"]}</code></p>
</div>
<div class="paragraph">
<p>The bundle has been compressed using an unmanaged format.</p>
</div>
<div class="sect5">
<h6 id="_format_verification">Format verification</h6>
<div class="sect6">
<h7 id="_linux_solution">Linux solution</h7>
<div class="paragraph">
<p>Command line example to verify the format of a bundle archive named
<code>MyBundleToTest.tar.gz</code>(which gives the mentionned error when uploaded):</p>
</div>
<div class="literalblock">
<div class="content">
<pre> tar -tzf MyBundleToTest.tar.gz &gt;/dev/null</pre>
</div>
</div>
<div class="paragraph">
<p>which should return in such case the following messages:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>gzip: stdin: not in gzip format
tar: Child returned status 1
tar: Error is not recoverable: exiting now</pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_solution_2">Solution</h6>
<div class="paragraph">
<p>Use <code>tar.gz</code> format for the archive compression. Shell command is <code>tar -czvf
MyBundleToTest.tar.gz config.json template/ css/</code> for a bundle containing
templates and css files.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_my_bundle_is_rejected_due_to_internal_structure">My bundle is rejected due to internal structure</h5>
<div class="paragraph">
<p>The server sends <code>{"status":"BAD_REQUEST","message":"Incorrect inner file
structure","errors":["$OPERATOR_FABRIC_INSTANCE_PATH/d91ba68c-de6b-4635-a8e8-b58
fff77dfd2/config.json (Aucun fichier ou dossier de ce type)"]}</code></p>
</div>
<div class="paragraph">
<p>Where <code>$OPERATOR_FABRIC_INSTANCE_PATH</code> is the folder where thirds files are
stored server side.</p>
</div>
<div class="sect5">
<h6 id="_reason">Reason</h6>
<div class="paragraph">
<p>The internal file structure of your bundle is incorrect. <code>config.json</code> file and
folders need to be at the first level.</p>
</div>
</div>
<div class="sect5">
<h6 id="_solution_3">Solution</h6>
<div class="paragraph">
<p>Add or organize the files and folders of the bundle to fit the Third bundle
requierements.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_no_template_display">No template display</h5>
<div class="paragraph">
<p>The server send 404 for requested template with a repsonse like
<code>{"status":"NOT_FOUND","message":"The specified resource does not
exist","errors":["$OPERATOR_FABRIC_INSTANCE_PATH/thirds-storage/BUNDLE_TEST/1/te
mplate/fr/template1.handlebars (Aucun fichier ou dossier de ce type)"]}</code></p>
</div>
<div class="sect5">
<h6 id="_verification">Verification</h6>
<div class="paragraph">
<p>The previous server response is return for a request like:
<code>http://localhost:2002/thirds/BUNDLE_TEST/templates/template1?locale=fr&amp;version
=1</code></p>
</div>
<div class="paragraph">
<p>The bundle is lacking localized folder and doesn&#8217;t contain the requested
localization.</p>
</div>
<div class="paragraph">
<p>If you have access to the <code>card-publication</code> micro service souce code you
should list the content of
<code>$CARDS_PUBLICATION_PROJECT/build/docker-volume/third-storage</code></p>
</div>
</div>
<div class="sect5">
<h6 id="_solution_4">Solution</h6>
<div class="paragraph">
<p>Either request another l10n or add the requested one to the bundle and
re-upload it.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_my_template_is_not_used">My template is not used.</h5>
<div class="paragraph">
<p>It need to be declared in the config.json of the bundle.</p>
</div>
<div class="sect5">
<h6 id="_solution_5">Solution</h6>
<div class="paragraph">
<p>Add or verify the name of the templates declared in the <code>config.json</code> file of
the bundle.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_my_value_is_not_displayed_in_the_detail_template">My value is not displayed in the detail template</h5>
<div class="paragraph">
<p>There are several possibilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the path of the data used in the template is incorrect;</p>
</li>
<li>
<p>number of pair of <code>{</code> and <code>}</code> has to follow those rules:</p>
<div class="ulist">
<ul>
<li>
<p>with no helper the good number is only 2 pairs;</p>
</li>
<li>
<p>with OperatorFabric helpers it&#8217;s 3 pairs of them.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_operatorfabric_user_service">3.5. OperatorFabric User Service</h3>
<div class="paragraph">
<p>The User service manage users and groups.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Users</dt>
<dd>
<p>represent account information for person destined to receive cards in the OperatorFabric instance.</p>
</dd>
<dt class="hdlist1">Groups</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>represent set of users destined to receive collectively some cards.</p>
</li>
<li>
<p>can be used in a way to handle rights on card reception in OperatorFabric.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The user define here is an internal representation of the individual card recipient in <code>OperatorFabric</code> the authentication is leave to specific OAuth2 extrernal service.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the following commands the <code>$token</code> is an authentication token currently valid for the <code>OAuth2</code> service used by the current <code>OperatorFabric</code> system.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_cookbook">3.5.1. Cookbook</h4>
<div class="paragraph">
<p>A new operator call John Doe, who has OAuth granted right to connect ot current <code>OperatorFabric</code> instance, need to receive cards within current <code>OperatorFabric</code> instance. As a user of OperatorFabric, he needes to be added to the system with a <code>login</code> (john-doe-opertaor), his <code>firstName</code> (John) and his <code>lastName</code> (Doe).
opertaor
As there is no <code>Administration GUI</code> for the moment, it must be performed through command line, as specify <a href="https://opfab.github.io/projects/services/core/users/0.1.1.RELEASE/api/#SimpleUser">here</a>.</p>
</div>
<div class="sect4">
<h5 id="_list_all_users">List all users</h5>
<div class="paragraph">
<p>First of all, list the users (who are the recipients in OperatorFabric) of the system with the following commands:</p>
</div>
<div class="paragraph">
<p>Httpie</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http http://localhost:2103/groups "Authorization:Bearer $token" "Content-Type:application/type"</pre>
</div>
</div>
<div class="paragraph">
<p>cURL</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -v http://localhost:2103/users -H "Authorization:Bearer $token" -H "Content-Type:application/type"</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

[
    {
        "firstName": null,
        "groups": [
            "ADMIN"
        ],
        "lastName": null,
        "login": "admin"
    },
    {
        "firstName": null,
        "groups": [
            "RTE",
            "ADMIN",
            "CORESO",
            "TRANS",
            "TEST"
        ],
        "lastName": null,
        "login": "rte-operator"
    },
    {
        "firstName": null,
        "groups": [
            "ELIA"
        ],
        "lastName": null,
        "login": "elia-operator"
    },
    {
        "firstName": null,
        "groups": [
            "CORESO"
        ],
        "lastName": null,
        "login": "coreso-operator"
    },
    {
        "firstName": null,
        "groups": [
            "TSO1",
            "TRANS",
            "TEST"
        ],
        "lastName": null,
        "login": "tso1-operator"
    },
    {
        "firstName": null,
        "groups": [
            "TSO2",
            "TRANS"
        ],
        "lastName": null,
        "login": "tso2-operator"
    },
]</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_create_a_new_user">Create a new User</h5>
<div class="paragraph">
<p>We are sure that no John-doe-operator exists in our OperatorFabric instance. We can add him in our OperatorFabric instance using the following command use httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>echo '{"login":"john-doe-operator","firstName":"Jahne","lastName":"Doe"}' | http POST http://localhost:2103/users "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>Or here cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X POST http://localhost:2103/users -H "Authorization:Bearer $token" -H "Content-Type:application/json" --data '{"login":"john-doe-operator","firstName":"Jahne","lastName":"Doe"}'</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "firstName": "Jahne",
    "lastName": "Doe",
    "login": "john-doe-operator"
}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_fetch_user_details">Fetch user details</h5>
<div class="paragraph">
<p>It&#8217;s always a good thing to verify if all the information has been correctely recorded in the system:</p>
</div>
<div class="paragraph">
<p>with httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http -b http://localhost:2103/users/john-doe-operator "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>or with cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://localhost:2103/users/test-login-operator -H "Authorization:Bearer $token" -H "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "firstName": "Jahne",
    "groups": [],
    "lastName": "Doe",
    "login": "john-doe-operator"
}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_update_user_details">Update user details</h5>
<div class="paragraph">
<p>As shown by this result, the firstName of the new operator has been mispelled.We need <a href="https://opfab.github.io/projects/services/core/users/0.1.1.RELEASE/api/#updateUser">to update the existing user</a> with <code>john-doe-operator</code> login. To correct this mistake, the following commands can be used :</p>
</div>
<div class="paragraph">
<p>with httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>echo '{"login":"john-doe-operator","lastName":"Doe","firstName":"John"}' | http PUT http://localhost:2103/users/john-doe-operator "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>or with cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X PUT http://localhost:2103/users/john-doe-operator -H "Authorization:Bearer $token" -H "Content-Type:application/json" --data '{"login":"john-doe-operator","firstName":"John","lastName":"Doe"}'</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "firstName": "John",
    "lastName": "Doe",
    "login": "john-doe-operator"
}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_list_groups">List groups</h5>
<div class="paragraph">
<p>This operator is the first member of a new group operator called the <code>OPERATORS</code>, which doesn&#8217;t exist for the moment in the system. As shown when we <a href="https://opfab.github.io/projects/services/core/users/0.1.1.RELEASE/api/#fetchGroups">lists the groups existing in the server</a>.</p>
</div>
<div class="paragraph">
<p>Httpie</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http http://localhost:2103/groups "Authorization:Bearer $token" "Content-Type:application/type"</pre>
</div>
</div>
<div class="paragraph">
<p>cURL</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl http://localhost:2103/groups -H "Authorization:Bearer $token" -H "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

[
    {
        "description": "The admin group",
        "name": "ADMIN"
    },
    {
        "description": "RTE TSO Group",
        "name": "RTE"
    },
    {
        "description": "ELIA TSO group",
        "name": "ELIA"
    },
    {
        "description": "CORESO Group",
        "name": "CORESO"
    },
    {
        "description": "TSO 1 Group",
        "name": "TSO1"
    },
    {
        "description": "TSO 2 Group",
        "name": "TSO2"
    },
    {
        "description": "Transnationnal Group",
        "name": "TRANS"
    }
]</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_create_a_new_group">Create a new Group</h5>
<div class="paragraph">
<p>Firstly, the group called <code>OPERATORS</code> has <a href="https://opfab.github.io/projects/services/core/users/0.1.1.RELEASE/api/#createGroup">to be added to the system</a> using the following command:</p>
</div>
<div class="paragraph">
<p>using httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>echo '{"name":"OPERATORS","decription":"This is the brand new  group of operator"}' | http POST http://localhost:2103/groups "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>using cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X POST http://localhost:2103/groups -H "Authorization:Bearer $token" -H "Content-Type:application/json" --data '{"name":"OPERATORS","decription":"This is the brand new  group of operator"}'</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "description": null,
    "name": "OPERATORS"
}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_fetch_details_of_a_given_group">Fetch details of a given group</h5>
<div class="paragraph">
<p>The result return seems strange, to verify if it&#8217;s the correct answer by <a href="https://opfab.github.io/projects/services/core/users/0.1.1.RELEASE/api/#fetchGroup">displaying the details of the group</a> called <code>OPERATORS</code>, use the following command:</p>
</div>
<div class="paragraph">
<p>using httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http http://localhost:2103/groups/OPERATORS "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>using cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl http://localhost:2103/groups/OPERATORS -H "Authorization:Bearer $token" -H "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "description": null,
    "name": "OPERATORS"
}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_update_details_of_a_group">Update details of a group</h5>
<div class="paragraph">
<p>The description is really null. After verification, in our first command used to create the group, the attribut for the description is misspelled. Using the following command <a href="https://opfab.github.io/projects/services/core/users/0.1.1.RELEASE/api/#updateGroup">to update the group</a>, with the correct spelling, the new group of operator gets a proper description:</p>
</div>
<div class="paragraph">
<p>with httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>echo '{"name":"OPERATORS","description":"This is the brand new  group of operator"}' | http -b PUT http://localhost:2103/groups/OPERATORS "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>with cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http -b PUT http://localhost:2103/groups/OPERATORS -H "Authorization:Bearer $token" -H "Content-Type:application/json" --data '{"name":"OPERATORS","description":"This is the brand new  group of operator"}'</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "description": "This is the brand new  group of operator",
    "name": "OPERATORS"
}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_add_a_user_to_a_group">Add a user to a group</h5>
<div class="paragraph">
<p>As both new group and new user are correct it&#8217;s time <a href="https://opfab.github.io/projects/services/core/users/0.1.1.RELEASE/api/#addGroupUsers">to make the user member of the group</a>. To achieve this, use the following command:</p>
</div>
<div class="paragraph">
<p>with httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>echo '["john-doe-operator"]' | http POST http://localhost:2103/groups/OPERATORS/users "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>with cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http POST http://localhost:2103/groups/OPERATORS/users -H "Authorization:Bearer $token" -H "Content-Type:application/json" --data '["john-doe-operator"]'</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK</pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s verify that the changes are correctelly recorded by fetching the :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http http://localhost:2103/users/john-doe-operator "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>with cURL</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl http://localhost:2103/users/john-doe-operator -H "Authorization:Bearer $token" -H "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "firstName": "John",
    "groups": ["OPERATORS"],
    "lastName": "Doe",
    "login": "john-doe-operator"
}</pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s now possible to send cards either specifically to <code>john-doe-operator</code> or more generally to the <code>OPERATORS</code> group.</p>
</div>
</div>
<div class="sect4">
<h5 id="_remove_a_user_from_a_group">Remove a user from a Group</h5>
<div class="paragraph">
<p>When John Doe is no longer in charge of hypervising cards for <code>OPERATORS</code> group, this group has to be remove from his login by using the following command:</p>
</div>
<div class="paragraph">
<p>with httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>echo '["john-doe-operator"]' | http DELETE http://localhost:2103/groups/OPERATORS/users "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>with cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X DELETE -H "Authorization:Bearer $token" -H "Content-Type:application/json" http://localhost:2103/users/john-doe-operator</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
	"login":"john-doe-operator","
	firstName":"John",
	"lastName":"Doe",
	"groups":[]
}</pre>
</div>
</div>
<div class="paragraph">
<p>A last command to verify that <code>OPERATORS</code> is no longer linked to <code>john-doe-operator</code>:</p>
</div>
<div class="paragraph">
<p>with httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http http://localhost:2103/users/john-doe-operator "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>with cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl http://localhost:2103/users/john-doe-operator -H "Authorization:Bearer $token" -H "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "firstName": "John",
    "groups": [],
    "lastName": "Doe",
    "login": "coreso-operator"

}</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_users_and_groups">3.5.2. Users and Groups</h4>
<div class="paragraph">
<p>User service manager users and groups.</p>
</div>
<div class="sect4">
<h5 id="_users">Users</h5>
<div class="paragraph">
<p>Users are the individuals and mainly physical person who can log in OperatorFabric.</p>
</div>
<div class="paragraph">
<p>The access to this service as to be authorized, in the <code>OAuth2</code> service use by the current <code>OperatorFabric</code> instance, at least to access User informations and to manage Users. The membership of groups is stored in the user information.</p>
</div>
</div>
<div class="sect4">
<h5 id="_groups">Groups</h5>
<div class="paragraph">
<p>The notion of group is loose and can be used to simulate role in <code>OpertaroFabric</code>. Groups are used to send cards to several users without name them specifically. The information about membership to a group is stored in the user information. The rules used to send cards are describe in the <a href="https://opfab.github.io/projects/services/core/cards-publication/0.1.1.RELEASE/reference/#_card_recipients">Card Publication Service</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_time_service_reference_documentation">3.6. Time Service Reference Documentation</h3>
<div class="sect3">
<h4 id="_introduction">3.6.1. Introduction</h4>
<div class="paragraph">
<p>The aim of this document is to describe the role of the Time Service in
OperatorFabric as well as
the features it provides.
It also includes code snippets demonstrating how to interact with the Time
Service through its API.</p>
</div>
<div class="paragraph">
<p>OperatorFabric services rely on the Time Service to get their current time.
This allows the reference time to be set anywhere in the past or the future.
In addition, the speed of time flow can also easily be altered: for example, go
twice as fast as real time.
This is useful mostly for test and demonstration purposes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For test purpose at start the time service (i.e the
<code>org.lfenergy.operatorfabric.time.services.TimeService</code> java class.) use a
default value called <code>defaultStartTime</code>
in the code, configured in the <code>resources/application.yml</code> and
<code>resources/application-dev.yml</code> of the <code>OperatorFabric Time</code> project.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We are also planning to add methods to the Time Services allowing to fast
forward in time (or rewind) up to the next received card (or the last received
card).
See <a href="https://github.com/opfab/operatorfabric-core/issues/80">issue 80</a> for more
details.</p>
</div>
</div>
<div class="sect3">
<h4 id="_concepts">3.6.2. Concepts</h4>
<div class="sect4">
<h5 id="_definitions">Definitions</h5>
<div class="paragraph">
<p>First of all, let us define the different "times" we will be discussing:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Real time
</td>
<td class="hdlist2">
<p>Time set by the server</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Virtual time
</td>
<td class="hdlist2">
<p>Time computed by the Time Service</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each date handled by the Time Service belongs either to real time or to virtual time.</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>EpochDate</code>
</td>
<td class="hdlist2">
<p>Dates are stored as a long integer representing the number of milliseconds since Epoch.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>SpeedEnum</code>
</td>
<td class="hdlist2">
<p>Speed of virtual time flow relatively to real time flow, represented by an enum value (e.g. <code>X2</code>, meaning virtual time flows twice as fast as real time).</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_virtual_time_computation">Virtual Time Computation</h5>
<div class="paragraph">
<p>The <code>TimeData</code> object stores the description of a time configuration,
containing the current virtual time as well as the references used for computation. All requests made to the Time service API use this format.
It is made up of the following properties:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>referenceTime</code>
</td>
<td class="hdlist2">
<p>Real server time at last time change</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>virtualTime</code>
</td>
<td class="hdlist2">
<p>Chosen virtual time start at last time change</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>computedNow</code>
</td>
<td class="hdlist2">
<p>Current virtual time computed by server as virtualTime + (now - referenceTime) * speed</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>speed</code>
</td>
<td class="hdlist2">
<p>Speed of virtual time flow</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Time service computes current virtual time (stored in computedNow) by</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>computing how much (real) time elapsed since we last "reset the clock"</p>
</li>
<li>
<p>multiplying this duration by the virtual time speed</p>
</li>
<li>
<p>adding it on top of the start time we had chosen for virtual time (virtualTime)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To make things less abstract, let&#8217;s say we want virtual time</p>
</div>
<div class="ulist">
<ul>
<li>
<p>to start one day ahead of real time</p>
</li>
<li>
<p>to flow 60 times as fast (meaning one elapsed second in real time will be one minute in virtual time)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We will send a request (more on that later) to the Time service API with the following <code>TimeData</code> object:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>referenceTime = current real time (as retrieved from the server), let&#8217;s say 10 000 000</p>
</li>
<li>
<p>virtualTime = current real time + one day, 96 400 000 (that&#8217;s 10 000 000 + 86 400 000)</p>
</li>
<li>
<p>computedNow = empty</p>
</li>
<li>
<p>speed = <code>X60</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We then wait two minutes (server time is now 10 000 000 + 2 * 60 000 = 10 060 000) and ask the Time service for the current time (using an API request).
 The Time service will return the following <code>TimeData</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>referenceTime = 10 000 000</p>
</li>
<li>
<p>virtualTime = 86 400 000</p>
</li>
<li>
<p>computedNow = 86 400 000 + (10 060 000 - 10 000 000) * 60 = 90 000 000</p>
</li>
<li>
<p>speed = <code>X60</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_api_endpoints">3.6.3. API Endpoints</h4>
<div class="paragraph">
<p>Please see the <a href="../api/index.html">Time API documentation</a> for full details and examples of the Time data model and associated API endpoints.</p>
</div>
</div>
<div class="sect3">
<h4 id="_demonstration">3.6.4. Demonstration</h4>
<div class="paragraph">
<p>This section demonstrates how to interact with the Time service through its API
by following a few simple scenarios.</p>
</div>
<div class="sect4">
<h5 id="_prerequisites">Prerequisites</h5>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
For these examples to work, you need to have a running Time service.
The requests below assume that the Time service is running on localhost on port
2101 (see
<a href="https://github.com/opfab/operatorfabric-core/blob/master/README.md">demo
setup</a>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can choose from several ways to send requests to the API, among which:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using curl (command line)</p>
</li>
<li>
<p>Using API development tools such as <a href="https://www.getpostman.com/">Postman</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We will use curl for our examples.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
In the following commands the <code>$token</code> is a valid authentication
token from the <code>OAuth2</code> server used by the current <code>OperatorFabric</code> instance.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Another option would be to use the Swagger UI. Provided that you have the
Time service running on localhost on port 2101,
the Swagger UI for the Time API is available at <a href="http://localhost:2101/" class="bare">localhost:2101/</a> . It
also displays documentation and examples next to each request.
However, requests requiring authentication won&#8217;t work as it isn&#8217;t set up yet.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_scenario_1_getting_the_current_virtual_time">Scenario 1: Getting the current virtual time</h5>
<div class="paragraph">
<p>Let&#8217;s say we want to get the current virtual time, which we expect to be equal
to real server time so far.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
No authentication is required for this request.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Curl command</div>
<div class="content">
<pre>curl -X GET "http://localhost:2101/time" \
    -H "Authorization:Bearer $token" \
    -H "accept: application/json"</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Response code</div>
<div class="content">
<pre>200 OK</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Response body</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">referenceTime</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>, <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">virtualTime</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>, <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">computedNow</span><span class="delimiter">&quot;</span></span>: <span class="integer">1553617695195</span>, <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">speed</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">X1</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Since the time hasn&#8217;t been changed yet, referenceTime and virtualTime
haven&#8217;t been set.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The current virtual time (number of milliseconds since Epoch), for example
this value converts to <em>March 26, 2019 4:28:15.195 PM GMT</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Speed of the virtual time flow relatively to real time flow. X1 means
they&#8217;re the same.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can use an <a href="https://www.epochconverter.com/">online converter</a> to
switch between epochDate and human readable date.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_scenario_2_setting_virtual_time_to_be_10_minutes_ahead_of_real_time">Scenario 2: Setting virtual time to be 10 minutes ahead of real time</h5>
<div class="paragraph">
<p>To set virtual time to be 10 minutes ahead of time, we use the POST request and
set the intended virtual time start (10 minutes from now) in the body:</p>
</div>
<div class="listingblock">
<div class="title">Example body</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">referenceTime</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>, <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">virtualTime</span><span class="delimiter">&quot;</span></span>: <span class="integer">1554111652000</span>, <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">computedNow</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>, <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">speed</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span> <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>These can be left blank as they won&#8217;t be used</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This should be the intended start of virtual time, about 10 minutes ahead
from now</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Curl command</div>
<div class="content">
<pre>curl -X POST \
    http://localhost:2101/time \
    -H "Authorization:Bearer $token" \
    -H "Content-Type:application/json" \
    -d '{
        "referenceTime": null,
        "virtualTime": 1554111652000,
        "computedNow": null,
        "speed": null
}'</pre>
</div>
</div>
<div class="paragraph">
<p>The response contains the current virtual time (computedNow) as well as the
references used for the computation.</p>
</div>
<div class="listingblock">
<div class="title">Response code</div>
<div class="content">
<pre>200 OK</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Response body</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">referenceTime</span><span class="delimiter">&quot;</span></span>: <span class="integer">1554111014449</span>, <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">virtualTime</span><span class="delimiter">&quot;</span></span>: <span class="integer">1554111652000</span>, <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">computedNow</span><span class="delimiter">&quot;</span></span>: <span class="integer">1554111652009</span>, <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">speed</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">X1</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="4"></i><b>(4)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Real time at the time of the time change = <em>April 1, 2019 9:30:14.449 AM
GMT</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Chosen start of virtual time = <em>April 1, 2019 9:40:52 AM GMT</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Current virtual time = <em>April 1, 2019 9:40:52.009 AM</em> &#8594; 9 milliseconds
have elapsed since server time change</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Speed hasn&#8217;t been changed.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
PUT /time does the exact same thing as POST /time as there was no need for
a different behaviour.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s ask for the current time again (using the GET request) a little while
later (real time is <em>April 1, 2019 11:37:43 AM GMT</em>)</p>
</div>
<div class="listingblock">
<div class="title">curl command</div>
<div class="content">
<pre>curl -X GET "http://localhost:2101/time" \
    -H "Authorization:Bearer $token" \
    -H "accept: application/json"</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Response code</div>
<div class="content">
<pre>200 OK</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Response body</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">referenceTime</span><span class="delimiter">&quot;</span></span>: <span class="integer">1554111014449</span>, <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">virtualTime</span><span class="delimiter">&quot;</span></span>: <span class="integer">1554111652000</span>, <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">computedNow</span><span class="delimiter">&quot;</span></span>: <span class="integer">1554119300367</span>, <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">speed</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">X1</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="4"></i><b>(4)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Real time at the time of the time change = <em>April 1, 2019 9:30:14.449 AM
GMT</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Chosen start of virtual time = <em>April 1, 2019 9:40:52 AM GMT</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Current virtual time = <em>April 1, 2019 11:48:20.367</em> &#8594; virtual time is
about 10 minutes ahead from real time as expected</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Speed hasn&#8217;t been changed.</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Notice how referenceTime, virtualTime and speed haven&#8217;t changed from
the response to the POST request to set the virtual time. They will only change
the next time is set or reset.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Postman to get token</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</body>
</html>