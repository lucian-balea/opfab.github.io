<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>operatorfabric-ui-main documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">operatorfabric-ui-main documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">







<ol class="breadcrumb">
  <li>Injectables</li>
  <li>UserEffects</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/store/effects/user.effects.ts</code>
        </p>




            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#checkUserApplication">checkUserApplication</a>
                            </li>
                            <li>
                                <a href="#CreateUserApplication">CreateUserApplication</a>
                            </li>
                            <li>
                                <a href="#transition2CreateUserApplication">transition2CreateUserApplication</a>
                            </li>
                            <li>
                                <a href="#transition2UserApplicationRegistered">transition2UserApplicationRegistered</a>
                            </li>
                        </ul>
                    </td>
                </tr>






        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(store: <a href="../interfaces/AppState.html">Store<AppState></a>, actions$: <a href="../classes/Action.html">Actions</a>, userService: <a href="../injectables/UserService.html">UserService</a>, authService: <a href="../injectables/AuthenticationService.html">AuthenticationService</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="23" class="link-to-prism">src/app/store/effects/user.effects.ts:23</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>store</td>
                                                  
                                                        <td>
                                                                        <code><a href="../interfaces/AppState.html" target="_self" >Store&lt;AppState&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>actions$</td>
                                                  
                                                        <td>
                                                                        <code><a href="../classes/Action.html" target="_self" >Actions</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>userService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/UserService.html" target="_self" >UserService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>authService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/AuthenticationService.html" target="_self" >AuthenticationService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>


            <section>
    
        <h3 id="inputs">
            Properties
        </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="checkUserApplication"></a>
                        <span class="name">
                            <b>
                            checkUserApplication</b>
                            <a href="#checkUserApplication"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="../miscellaneous/typealiases.html#UserActions" target="_self" >Observable&lt;UserActions&gt;</a></code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>this.actions$
        .pipe(
            ofType(AuthenticationActionTypes.AcceptLogIn),
            switchMap((action: AcceptLogIn) &#x3D;&gt; {
                const userPayload &#x3D; action.payload;
                return this.userService.askUserApplicationRegistered(userPayload.identifier)
                    .pipe(
                        map((user: User) &#x3D;&gt; new UserApplicationRegistered({user})),
                        catchError((error, caught) &#x3D;&gt; {
                            const userData: User &#x3D; new User(userPayload.identifier, userPayload.firstName, userPayload.lastName);
                            this.store.dispatch(new UserApplicationNotRegistered({error: error, user: userData}));
                            return caught;
                        })
                    );
            })
        )</code>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <b>Decorators : </b>
                            <br />
                            <code>
                                @Effect()<br />
                            </code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="38" class="link-to-prism">src/app/store/effects/user.effects.ts:38</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                        <div class="io-description"><p>after that the user is authentificated throught the token,
detect if the user is already registered in the application and raise the UserApplicationRegistered action
if not, set the creation user workflow</p>
</div>
                    </td>
                </tr>

            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="CreateUserApplication"></a>
                        <span class="name">
                            <b>
                            CreateUserApplication</b>
                            <a href="#CreateUserApplication"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="../miscellaneous/typealiases.html#UserActions" target="_self" >Observable&lt;UserActions&gt;</a></code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>this.actions$
        .pipe(
            ofType(UserActionsTypes.CreateUserApplication),
            switchMap((action: CreateUserApplication) &#x3D;&gt; {
                const user &#x3D; action.payload.user;
                return this.userService.askCreateUser(user)
                    .pipe(
                        map(currentUser &#x3D;&gt; {
                            // console.log(&quot;ok creation user &quot; + user.login);
                            return new CreateUserApplicationOnSuccess({user: currentUser});
                        }),
                        catchError((error, caught) &#x3D;&gt; {
                            // console.log(error, caught, &quot;error on creation user application for the user &quot;)
                            this.authService.clearAuthenticationInformation();
                            this.store.dispatch(new CreateUserApplicationOnFailure({error: error}));
                            return caught;
                        })
                    );
            }),
        )</code>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <b>Decorators : </b>
                            <br />
                            <code>
                                @Effect()<br />
                            </code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="74" class="link-to-prism">src/app/store/effects/user.effects.ts:74</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                        <div class="io-description"><p>create the user application (first time in the application)
raise an CreateUserApplicationOnSuccess action or CreateUserApplicationOnFailure action.</p>
</div>
                    </td>
                </tr>

            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="transition2CreateUserApplication"></a>
                        <span class="name">
                            <b>
                            transition2CreateUserApplication</b>
                            <a href="#transition2CreateUserApplication"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="../miscellaneous/typealiases.html#UserActions" target="_self" >Observable&lt;UserActions&gt;</a></code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>this.actions$
        .pipe(
            ofType(UserActionsTypes.UserApplicationNotRegistered),
            map((action: UserApplicationNotRegistered) &#x3D;&gt; {
                const userDataPayload &#x3D; action.payload.user;
                // console.log(&quot;transitionCreateUserApplication userPayload : &quot; + userDataPayload);
                return new CreateUserApplication({user: userDataPayload});
            })
        )</code>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <b>Decorators : </b>
                            <br />
                            <code>
                                @Effect()<br />
                            </code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="59" class="link-to-prism">src/app/store/effects/user.effects.ts:59</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                        <div class="io-description"><p>transition to the creation user application workflow</p>
</div>
                    </td>
                </tr>

            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="transition2UserApplicationRegistered"></a>
                        <span class="name">
                            <b>
                            transition2UserApplicationRegistered</b>
                            <a href="#transition2UserApplicationRegistered"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="../miscellaneous/typealiases.html#UserActions" target="_self" >Observable&lt;UserActions&gt;</a></code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>this.actions$
        .pipe(
            ofType(UserActionsTypes.CreateUserApplicationOnSuccess),
            map((action: CreateUserApplicationOnSuccess) &#x3D;&gt; {
                const userDataPayload &#x3D; action.payload.user;
                return new UserApplicationRegistered({user: userDataPayload});
            })
        )</code>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <b>Decorators : </b>
                            <br />
                            <code>
                                @Effect()<br />
                            </code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="99" class="link-to-prism">src/app/store/effects/user.effects.ts:99</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                        <div class="io-description"><p>transition to the userApplicationRegistered action after an CreateUserApplicationOnSuccess action</p>
</div>
                    </td>
                </tr>

            </tbody>
        </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import {Injectable} from &#x27;@angular/core&#x27;;
import {Store} from &#x27;@ngrx/store&#x27;;
import {AppState} from &quot;@ofStore/index&quot;;
import {Actions, Effect, ofType} from &#x27;@ngrx/effects&#x27;;
import {UserService} from &#x27;@ofServices/user.service&#x27;;
import {Observable} from &#x27;rxjs&#x27;;
import {
    CreateUserApplication,
    CreateUserApplicationOnFailure,
    CreateUserApplicationOnSuccess,
    UserActions,
    UserActionsTypes,
    UserApplicationNotRegistered,
    UserApplicationRegistered
} from &#x27;@ofStore/actions/user.actions&#x27;;
import {AcceptLogIn, AuthenticationActionTypes} from &#x27;@ofStore/actions/authentication.actions&#x27;;
import {catchError, map, switchMap} from &#x27;rxjs/operators&#x27;;
import {User} from &#x27;@ofModel/user.model&#x27;;
import {AuthenticationService} from &quot;@ofServices/authentication/authentication.service&quot;;


@Injectable()
export class UserEffects {

    constructor(private store: Store&lt;AppState&gt;,
                private actions$: Actions,
                private userService: UserService,
                private authService: AuthenticationService
    ) {
    }

    /**
     * after that the user is authentificated throught the token,
     * detect if the user is already registered in the application and raise the UserApplicationRegistered action
     * if not, set the creation user workflow
     */
    @Effect()
    checkUserApplication: Observable&lt;UserActions&gt; &#x3D; this.actions$
        .pipe(
            ofType(AuthenticationActionTypes.AcceptLogIn),
            switchMap((action: AcceptLogIn) &#x3D;&gt; {
                const userPayload &#x3D; action.payload;
                return this.userService.askUserApplicationRegistered(userPayload.identifier)
                    .pipe(
                        map((user: User) &#x3D;&gt; new UserApplicationRegistered({user})),
                        catchError((error, caught) &#x3D;&gt; {
                            const userData: User &#x3D; new User(userPayload.identifier, userPayload.firstName, userPayload.lastName);
                            this.store.dispatch(new UserApplicationNotRegistered({error: error, user: userData}));
                            return caught;
                        })
                    );
            })
        );

    /**
     * transition to the creation user application workflow
     */
    @Effect()
    transition2CreateUserApplication: Observable&lt;UserActions&gt; &#x3D; this.actions$
        .pipe(
            ofType(UserActionsTypes.UserApplicationNotRegistered),
            map((action: UserApplicationNotRegistered) &#x3D;&gt; {
                const userDataPayload &#x3D; action.payload.user;
                // console.log(&quot;transitionCreateUserApplication userPayload : &quot; + userDataPayload);
                return new CreateUserApplication({user: userDataPayload});
            })
        );

    /**
     * create the user application (first time in the application)
     * raise an CreateUserApplicationOnSuccess action or CreateUserApplicationOnFailure action.
     */
    @Effect()
    CreateUserApplication: Observable&lt;UserActions&gt; &#x3D; this.actions$
        .pipe(
            ofType(UserActionsTypes.CreateUserApplication),
            switchMap((action: CreateUserApplication) &#x3D;&gt; {
                const user &#x3D; action.payload.user;
                return this.userService.askCreateUser(user)
                    .pipe(
                        map(currentUser &#x3D;&gt; {
                            // console.log(&quot;ok creation user &quot; + user.login);
                            return new CreateUserApplicationOnSuccess({user: currentUser});
                        }),
                        catchError((error, caught) &#x3D;&gt; {
                            // console.log(error, caught, &quot;error on creation user application for the user &quot;)
                            this.authService.clearAuthenticationInformation();
                            this.store.dispatch(new CreateUserApplicationOnFailure({error: error}));
                            return caught;
                        })
                    );
            }),
        );

    /**
     * transition to the userApplicationRegistered action after an CreateUserApplicationOnSuccess action
     */
    @Effect()
    transition2UserApplicationRegistered: Observable&lt;UserActions&gt; &#x3D; this.actions$
        .pipe(
            ofType(UserActionsTypes.CreateUserApplicationOnSuccess),
            map((action: CreateUserApplicationOnSuccess) &#x3D;&gt; {
                const userDataPayload &#x3D; action.payload.user;
                return new UserApplicationRegistered({user: userDataPayload});
            })
        );

}
</code></pre>
    </div>

</div>







                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'UserEffects.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
