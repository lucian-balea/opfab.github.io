<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<title>CardSubscription (cards-consultation-business-service 1.2.0.SNAPSHOT API)</title>
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="CardSubscription (cards-consultation-business-service 1.2.0.SNAPSHOT API)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":10,"i1":10,"i2":10,"i3":9,"i4":10,"i5":10,"i6":10,"i7":10};
var tabs = {65535:["t0","All Methods"],1:["t1","Static Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev&nbsp;Class</li>
<li><a href="../../../../../../org/lfenergy/operatorfabric/cards/consultation/services/CardSubscriptionService.html" title="class in org.lfenergy.operatorfabric.cards.consultation.services"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?org/lfenergy/operatorfabric/cards/consultation/services/CardSubscription.html" target="_top">Frames</a></li>
<li><a href="CardSubscription.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.lfenergy.operatorfabric.cards.consultation.services</div>
<h2 title="Class CardSubscription" class="title">Class CardSubscription</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>org.lfenergy.operatorfabric.cards.consultation.services.CardSubscription</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="typeNameLabel">CardSubscription</span>
extends java.lang.Object</pre>
<div class="block"><p>This object manages subscription to AMQP exchange</p>

 <p>Two exchanges are used, <a href="../../../../../../org/lfenergy/operatorfabric/cards/consultation/services/CardSubscription.html#groupExchange"><code>groupExchange</code></a> and <a href="../../../../../../org/lfenergy/operatorfabric/cards/consultation/services/CardSubscription.html#userExchange"><code>userExchange</code></a>.
 See amqp.xml resource file ([project]/services/core/cards-publication/src/main/resources/amqp.xml)
 for their exact configuration</p></div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/lfenergy/operatorfabric/cards/consultation/services/CardSubscription.html#GROUPS_SUFFIX">GROUPS_SUFFIX</a></span></code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../../../org/lfenergy/operatorfabric/cards/consultation/services/CardSubscription.html#CardSubscription-org.lfenergy.operatorfabric.users.model.User-java.lang.String-java.lang.Runnable-org.springframework.amqp.core.AmqpAdmin-org.springframework.amqp.core.DirectExchange-org.springframework.amqp.core.FanoutExchange-org.springframework.amqp.rabbit.connection.ConnectionFactory-java.time.Instant-java.time.Instant-java.lang.Boolean-">CardSubscription</a></span>(org.lfenergy.operatorfabric.users.model.User&nbsp;user,
                java.lang.String&nbsp;clientId,
                java.lang.Runnable&nbsp;doOnCancel,
                org.springframework.amqp.core.AmqpAdmin&nbsp;amqpAdmin,
                org.springframework.amqp.core.DirectExchange&nbsp;userExchange,
                org.springframework.amqp.core.FanoutExchange&nbsp;groupExchange,
                org.springframework.amqp.rabbit.connection.ConnectionFactory&nbsp;connectionFactory,
                java.time.Instant&nbsp;rangeStart,
                java.time.Instant&nbsp;rangeEnd,
                java.lang.Boolean&nbsp;filterNotification)</code>
<div class="block">Constructs a card subscription and init access to AMQP exchanges</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t1" class="tableTab"><span><a href="javascript:show(1);">Static Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/lfenergy/operatorfabric/cards/consultation/services/CardSubscription.html#checkActive--">checkActive</a></span>()</code>&nbsp;</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/lfenergy/operatorfabric/cards/consultation/services/CardSubscription.html#checkIfUserMustReceiveTheCard-java.lang.String-">checkIfUserMustReceiveTheCard</a></span>(java.lang.String&nbsp;messageBody)</code>&nbsp;</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/lfenergy/operatorfabric/cards/consultation/services/CardSubscription.html#clearSubscription--">clearSubscription</a></span>()</code>
<div class="block">Stops associated <code>MessageListenerContainer</code> and delete queues</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>static java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/lfenergy/operatorfabric/cards/consultation/services/CardSubscription.html#computeSubscriptionId-java.lang.String-java.lang.String-">computeSubscriptionId</a></span>(java.lang.String&nbsp;prefix,
                     java.lang.String&nbsp;clientId)</code>&nbsp;</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code>org.springframework.amqp.rabbit.listener.MessageListenerContainer</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/lfenergy/operatorfabric/cards/consultation/services/CardSubscription.html#createMessageListenerContainer-java.lang.String-">createMessageListenerContainer</a></span>(java.lang.String&nbsp;queueName)</code>
<div class="block">Create a <code>MessageListenerContainer</code> for the specified queue</div>
</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/lfenergy/operatorfabric/cards/consultation/services/CardSubscription.html#initSubscription-java.lang.Runnable-">initSubscription</a></span>(java.lang.Runnable&nbsp;doOnCancel)</code>
<div class="block">
 Create a user queue and a group topic queue
 Associate queues to message <code>MessageListenerContainer</code>.
 Creates a amqpPublisher <code>Flux</code> to publish AMQP messages to
 </div>
</td>
</tr>
<tr id="i6" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/lfenergy/operatorfabric/cards/consultation/services/CardSubscription.html#publishInto-reactor.core.publisher.Flux-">publishInto</a></span>(reactor.core.publisher.Flux&lt;java.lang.String&gt;&nbsp;fetchOldCards)</code>&nbsp;</td>
</tr>
<tr id="i7" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/lfenergy/operatorfabric/cards/consultation/services/CardSubscription.html#updateRange-java.time.Instant-java.time.Instant-">updateRange</a></span>(java.time.Instant&nbsp;rangeStart,
           java.time.Instant&nbsp;rangeEnd)</code>&nbsp;</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="GROUPS_SUFFIX">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>GROUPS_SUFFIX</h4>
<pre>public static final&nbsp;java.lang.String GROUPS_SUFFIX</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../../constant-values.html#org.lfenergy.operatorfabric.cards.consultation.services.CardSubscription.GROUPS_SUFFIX">Constant Field Values</a></dd>
</dl>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="CardSubscription-org.lfenergy.operatorfabric.users.model.User-java.lang.String-java.lang.Runnable-org.springframework.amqp.core.AmqpAdmin-org.springframework.amqp.core.DirectExchange-org.springframework.amqp.core.FanoutExchange-org.springframework.amqp.rabbit.connection.ConnectionFactory-java.time.Instant-java.time.Instant-java.lang.Boolean-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>CardSubscription</h4>
<pre>public&nbsp;CardSubscription(org.lfenergy.operatorfabric.users.model.User&nbsp;user,
                        java.lang.String&nbsp;clientId,
                        java.lang.Runnable&nbsp;doOnCancel,
                        org.springframework.amqp.core.AmqpAdmin&nbsp;amqpAdmin,
                        org.springframework.amqp.core.DirectExchange&nbsp;userExchange,
                        org.springframework.amqp.core.FanoutExchange&nbsp;groupExchange,
                        org.springframework.amqp.rabbit.connection.ConnectionFactory&nbsp;connectionFactory,
                        java.time.Instant&nbsp;rangeStart,
                        java.time.Instant&nbsp;rangeEnd,
                        java.lang.Boolean&nbsp;filterNotification)</pre>
<div class="block">Constructs a card subscription and init access to AMQP exchanges</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>user</code> - connected user</dd>
<dd><code>clientId</code> - id of client (generated by ui)</dd>
<dd><code>doOnCancel</code> - a runnable to call on subscription cancellation</dd>
<dd><code>amqpAdmin</code> - AMQP management component</dd>
<dd><code>userExchange</code> - configured exchange for orphaned user messages</dd>
<dd><code>groupExchange</code> - configured exchange for group messages</dd>
<dd><code>connectionFactory</code> - AMQP connection  factory to instantiate listeners</dd>
</dl>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="computeSubscriptionId-java.lang.String-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>computeSubscriptionId</h4>
<pre>public static&nbsp;java.lang.String&nbsp;computeSubscriptionId(java.lang.String&nbsp;prefix,
                                                     java.lang.String&nbsp;clientId)</pre>
</li>
</ul>
<a name="initSubscription-java.lang.Runnable-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>initSubscription</h4>
<pre>public&nbsp;void&nbsp;initSubscription(java.lang.Runnable&nbsp;doOnCancel)</pre>
<div class="block"><ul>
 <li>Create a user queue and a group topic queue</li>
 <li>Associate queues to message <code>MessageListenerContainer</code>.</li>
 <li>Creates a amqpPublisher <code>Flux</code> to publish AMQP messages to</li>
 </ul>
 <p>
 Listeners starts on <code>Flux</code> subscription.
 </p>
 <p>On subscription cancellation triggers doOnCancel</p></div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>doOnCancel</code> - </dd>
</dl>
</li>
</ul>
<a name="clearSubscription--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>clearSubscription</h4>
<pre>public&nbsp;void&nbsp;clearSubscription()</pre>
<div class="block">Stops associated <code>MessageListenerContainer</code> and delete queues</div>
</li>
</ul>
<a name="checkActive--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>checkActive</h4>
<pre>public&nbsp;boolean&nbsp;checkActive()</pre>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>true if associated AMQP listeners are still running</dd>
</dl>
</li>
</ul>
<a name="createMessageListenerContainer-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>createMessageListenerContainer</h4>
<pre>public&nbsp;org.springframework.amqp.rabbit.listener.MessageListenerContainer&nbsp;createMessageListenerContainer(java.lang.String&nbsp;queueName)</pre>
<div class="block">Create a <code>MessageListenerContainer</code> for the specified queue</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>queueName</code> - AMQP queue name</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>listener container for the specified queue</dd>
</dl>
</li>
</ul>
<a name="updateRange-java.time.Instant-java.time.Instant-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>updateRange</h4>
<pre>public&nbsp;void&nbsp;updateRange(java.time.Instant&nbsp;rangeStart,
                        java.time.Instant&nbsp;rangeEnd)</pre>
</li>
</ul>
<a name="publishInto-reactor.core.publisher.Flux-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>publishInto</h4>
<pre>public&nbsp;void&nbsp;publishInto(reactor.core.publisher.Flux&lt;java.lang.String&gt;&nbsp;fetchOldCards)</pre>
</li>
</ul>
<a name="checkIfUserMustReceiveTheCard-java.lang.String-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>checkIfUserMustReceiveTheCard</h4>
<pre>public&nbsp;boolean&nbsp;checkIfUserMustReceiveTheCard(java.lang.String&nbsp;messageBody)</pre>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>messageBody</code> - message body received from rabbitMQ</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>true if the message received is either :
 1) intended for one of the user's groups and there is no entityRecipients in the card
 2) or intended for one of the user's entities and there is no groupRecipients in the card
 3) or intended for one of the user's groups and also for one of the user's entities</dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev&nbsp;Class</li>
<li><a href="../../../../../../org/lfenergy/operatorfabric/cards/consultation/services/CardSubscriptionService.html" title="class in org.lfenergy.operatorfabric.cards.consultation.services"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?org/lfenergy/operatorfabric/cards/consultation/services/CardSubscription.html" target="_top">Frames</a></li>
<li><a href="CardSubscription.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
